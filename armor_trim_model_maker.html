<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://potatowolfie.github.io">
    <meta property="og:title" content="Armor Trim Item Model Generator">
    <meta property="og:description" content="Making armor trims appear on items done easier.">
    <meta property="og:image" content="https://potatowolfie.github.io/assets/home/logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="PotatoWolfie">
    <meta name="theme-color" content="#3453df">
    <meta property="og:locale" content="en_US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://potatowolfie.github.io">
    <meta name="twitter:title" content="Armor Trim Item Model Generator">
    <meta property="og:description" content="Making armor trims appear on items done easier.">
    <meta name="twitter:image" content="https://potatowolfie.github.io/assets/home/logo.png">
    <title>Armor Trim Item Model Generator</title>
    <link rel="icon" type="image/x-icon" href="goggles.ico">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.bunny.net/css?family=nunito:200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Minecraft Ten';
            src: url('assets/fonts/minecraft.woff2') format('woff2'),
                 url('assets/fonts/minecraft.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-image: url('assets/home/background.png');
            background-color: #2d2d2d;
            background-size: auto;
            background-repeat: repeat;
            background-position: top left;
            color: #e6e6e6;
            min-height: 100vh;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #262626;
            border: none;
            padding: 30px;
        }

        .page-title {
            font-size: 28px;
            margin-bottom: 25px;
            color: #3453df;
            border-bottom: 2px solid #4a4a4a;
            padding-bottom: 15px;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
            font-weight: normal;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #2e2e2e;
            border: 2px solid #1a1a1a;
            position: relative;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            box-shadow: inset 2px 2px 0 #3a3a3a, inset -2px -2px 0 #242424;
            pointer-events: none;
        }

        .section-content {
            position: relative;
            z-index: 1;
        }

        .section h2 {
            color: #3453df;
            margin-bottom: 15px;
            font-size: 18px;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
            font-weight: normal;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .input-wrapper {
    position: relative;
}

a {
    color: #3453df;
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: #5a73ff;
    text-decoration: underline;
}

a:visited {
    color: #3453df;
}

a:active {
    color: #2a42bf;
}

.validation-icon {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    display: none;
    z-index: 10;
}

.validation-icon.show {
    display: block;
    animation: shake 0.3s ease;
}

.validation-icon img {
    width: 100%;
    height: 100%;
    filter: brightness(0) saturate(100%) invert(30%) sepia(95%) saturate(2500%) hue-rotate(345deg);
}

@keyframes shake {
    0%, 100% { transform: translateY(-50%) translateX(0); }
    25% { transform: translateY(-50%) translateX(-5px); }
    75% { transform: translateY(-50%) translateX(5px); }
}

input.invalid {
    border-color: #8b3a3a !important;
    animation: pulse-red 0.5s ease;
}

@keyframes pulse-red {
    0%, 100% { border-color: #8b3a3a; }
    50% { border-color: #b35f5f; }
}

        label {
            display: block;
            margin-bottom: 5px;
            color: #cccccc;
            font-size: 14px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            background: #3a3a3a;
            border: 2px solid #1a1a1a;
            color: #e6e6e6;
            font-size: 14px;
            box-shadow: inset 2px 2px 0 #2a2a2a, inset -2px -2px 0 #4a4a4a;
            text-transform: lowercase;
            font-family: 'Nunito', sans-serif;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #3453df;
        }

        input[type="text"]::placeholder {
            text-transform: none;
        }

        .chip-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            min-height: 40px;
            padding: 10px;
            background: #3a3a3a;
            border: 2px solid #1a1a1a;
            box-shadow: inset 2px 2px 0 #2a2a2a, inset -2px -2px 0 #4a4a4a;
        }

        .chip {
            background: #48494a;
            color: white;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            box-shadow: inset 1px 1px 0 #6c6d6d, inset -1px -1px 0 #2a2a2a;
        }

        .chip button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chip button:hover {
            color: #ff6b6b;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: #cccccc;
            user-select: none;
        }

        input[type="checkbox"] {
    cursor: pointer;
    width: 16px;
    height: 16px;
    appearance: none;
    -webkit-appearance: none;
    background-image: url('assets/buttons/checkbox.png');
    background-size: 16px 16px;
    background-repeat: no-repeat;
    background-position: center;
    border: none;
    box-shadow: none;
    background-color: transparent;
    border-radius: 0;
    image-rendering: -moz-crisp-edges;
    image-rendering: -webkit-crisp-edges;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}

input[type="checkbox"]:checked {
    background-image: url('assets/buttons/checkboxchecked.png');
}

        .mod-entry {
            background: #3a3a3a;
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #1a1a1a;
            box-shadow: inset 1px 1px 0 #4a4a4a, inset -1px -1px 0 #2a2a2a;
            position: relative;
        }

        .drag-handle img {
    width: 100%;
    height: 100%;
    image-rendering: pixelated;
    pointer-events: none;
    user-drag: none;
    -webkit-user-drag: none;
    user-select: none;
    -webkit-user-select: none;
}

.drag-handle {
    width: 32px;
    height: 32px;
    cursor: grab;
    display: none;
    align-items: center;
    justify-content: center;
    margin-right: 10px;
    flex-shrink: 0;
    user-select: none;
    -webkit-user-select: none;
}

        .drag-handle:active {
            cursor: grabbing;
        }

        .drag-handle img {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
        }

        .mod-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            color: #3453df;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
        }

        .mod-entry-title {
            display: flex;
            align-items: center;
        }

        .minecraft-button {
            cursor: pointer;
            height: 45px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            border: none;
            user-select: none;
            background: none;
            padding: 0;
            min-width: 250px;
        }

        .minecraft-button-left-outline {
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            bottom: 0;
            background: #1e1e1e;
            z-index: 5;
            transition: transform 0.15s ease;
        }

        .minecraft-button-right-outline {
            position: absolute;
            top: 0;
            right: 0;
            width: 2px;
            bottom: 0;
            background: #1e1e1e;
            z-index: 5;
            transition: transform 0.15s ease;
        }

        .minecraft-button-section {
            flex: 1;
            background: #48494a;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 1px 1px 0 #6c6d6d, inset -1px -1px 0 #5b5c5c;
            overflow: hidden;
            z-index: 2;
            transition: transform 0.15s ease;
            margin: 0 2px;
            margin-bottom: 0;
            border-top: 2px solid #1e1e1e;
        }

        .minecraft-button-dark-strip {
            height: 8px;
            background: #3b3c3c;
            position: relative;
            z-index: 2;
            transition: transform 0.15s ease, opacity 0.15s ease;
            margin: 0 2px;
            margin-top: 0;
        }

        .minecraft-button-bottom-outline {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #1e1e1e;
            z-index: 5;
        }

        .minecraft-button-shadow {
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #1a1a1a;
            z-index: 1;
            transition: transform 0.15s ease, opacity 0.15s ease;
        }

        .minecraft-button-name {
            font-size: 15px;
            color: #ffffff;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
            font-weight: normal;
            position: relative;
            z-index: 2;
            white-space: nowrap;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.8);
            min-width: auto;
            padding: 0 50px;
        }

        .minecraft-button.pressed .minecraft-button-section {
            transform: translateY(6px);
        }

        .minecraft-button.pressed .minecraft-button-left-outline,
        .minecraft-button.pressed .minecraft-button-right-outline {
            transform: translateY(6px);
        }

        .minecraft-button.pressed .minecraft-button-dark-strip,
        .minecraft-button.pressed .minecraft-button-shadow {
            transform: translateY(3px);
            opacity: 0;
        }

        .minecraft-button:hover .minecraft-button-section {
            background: #414242;
        }

        .minecraft-button:hover .minecraft-button-dark-strip {
            background: #323333;
        }

        .minecraft-button.small {
            height: 35px;
            display: inline-flex;
            min-width: 120px;
        }

        .minecraft-button.small .minecraft-button-name {
            font-size: 13px;
        }

        .minecraft-button.danger .minecraft-button-section {
            background: #8b3a3a;
            box-shadow: inset 1px 1px 0 #b35f5f, inset -1px -1px 0 #a04e4e;
        }

        .minecraft-button.danger:hover .minecraft-button-section {
            background: #a04444;
        }

        .minecraft-button.danger .minecraft-button-dark-strip {
            background: #6b2525;
        }

        .minecraft-button.success .minecraft-button-section {
            background: #3a8b4a;
            box-shadow: inset 1px 1px 0 #58c169, inset -1px -1px 0 #4fb35f;
        }

        .minecraft-button.success:hover .minecraft-button-section {
            background: #2d6b3a;
        }

        .minecraft-button.success .minecraft-button-dark-strip {
            background: #2a6b35;
        }

        .button-row {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .download-section {
            margin-top: 30px;
            padding: 20px;
            background: #2e2e2e;
            border: 2px solid #1a1a1a;
            position: relative;
            display: none;
        }

        .download-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            box-shadow: inset 2px 2px 0 #3a3a3a, inset -2px -2px 0 #242424;
            pointer-events: none;
        }

        .download-section.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .download-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .download-info {
            color: #cccccc;
            margin: 15px 0;
            font-size: 16px;
        }

        .summary-stats {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin: 20px 0;
    flex-wrap: wrap;
}

.stat-item {
    background: #3a3a3a;
    padding: 15px 25px;
    border: 2px solid #1a1a1a;
    box-shadow: inset 1px 1px 0 #4a4a4a, inset -1px -1px 0 #2a2a2a;
    text-align: center;
}

.stat-number {
    font-size: 28px;
    color: #3453df;
    font-family: 'Minecraft Ten', 'Inter', sans-serif;
    display: block;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 13px;
    color: #a0a0a0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

        .file-size {
            color: #3453df;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
            font-size: 20px;
            margin: 10px 0;
        }

        .directory-info {
            margin-top: 20px;
            padding: 15px;
            background: #1a1a1a;
            color: #a0a0a0;
            font-size: 13px;
            line-height: 1.6;
            border-left: 3px solid #3453df;
        }

        .directory-info strong {
            color: #3453df;
        }

        .preview-dropdown {
            margin-top: 20px;
            background: #2e2e2e;
            border: 2px solid #1a1a1a;
            position: relative;
            min-height: 60px;
            transition: all 0.3s ease;
            user-select: none;
        }

        .preview-dropdown::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            box-shadow: inset 2px 2px 0 #3a3a3a, inset -2px -2px 0 #242424;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            cursor: pointer;
            position: relative;
            background: transparent;
        }

        .preview-dropdown.expanded .preview-header {
            border-bottom: 2px solid #1a1a1a;
        }

        .preview-header-text {
            position: relative;
            z-index: 2;
            font-size: 18px;
            color: #3453df;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
            font-weight: normal;
        }

        .preview-header-arrow {
            width: 15px;
            height: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.4s ease;
            transform: rotate(0deg);
        }

        .preview-header-arrow img {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
        }

        .preview-grid {
            position: relative;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: #2e2e2e;
        }

        .preview-grid::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            box-shadow: inset 2px 2px 0 #3a3a3a, inset -2px -2px 0 #242424;
            pointer-events: none;
        }

        .preview-grid.open {
            max-height: 500px;
            overflow-y: auto;
        }

        .preview-content {
            position: relative;
            z-index: 1;
            padding: 20px;
        }

        .search-container {
            margin-bottom: 15px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 8px 12px;
            background: #3a3a3a;
            border: 2px solid #1a1a1a;
            color: #e6e6e6;
            font-size: 16px;
            font-family: 'Nunito', sans-serif;
            box-shadow: inset 2px 2px 0 #2a2a2a, inset -2px -2px 0 #4a4a4a;
        }

        .search-box:focus {
            outline: none;
            border: 2px solid #3453df;
        }

        .file-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-item {
    padding: 12px 16px;
    border: 2px solid #1a1a1a;
    background: #3a3a3a;
    color: #cccccc;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    transition: all 0.2s ease;
    box-shadow: inset 1px 1px 0 #4a4a4a, inset -1px -1px 0 #2a2a2a;
    min-height: auto; /* allow flexible sizing */
    overflow: visible; /* let content expand */
}

        .file-item:hover {
            background: #424242;
            border-color: #3453df;
        }

        .file-item:hover .file-name {
            color: #3453df;
        }

        .file-category {
            font-size: 12px;
            color: #3453df;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
            font-weight: normal;
        }

        .file-name {
            font-size: 14px;
            margin-top: 2px;
            font-family: 'Nunito', sans-serif;
            color: #cccccc;
            transition: color 0.2s ease;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: #2e2e2e;
            border: 2px solid #1a1a1a;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: inset 2px 2px 0 #3a3a3a, inset -2px -2px 0 #242424, 0 4px 20px rgba(0,0,0,0.5);
        }

        .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    border-bottom: 1px solid #4a4a4a;
    background-color: #343231;
}

        .modal-title {
            color: #3453df;
            font-size: 18px;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
        }

        .modal-close {
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    width: 28px;
    height: 28px;
    flex-shrink: 0;
    margin: 0;
}

.modal-close img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
    pointer-events: none;
}

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-body pre {
            background: #1a1a1a;
            padding: 15px;
            overflow-x: auto;
            color: #e6e6e6;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            border: 2px solid #0a0a0a;
            box-shadow: inset 1px 1px 0 #2a2a2a;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 2px solid #1a1a1a;
            display: flex;
            justify-content: center;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 0;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            background: #2e2e2e;
            border: 2px solid #1a1a1a;
            padding: 15px 20px;
            min-width: 250px;
            box-shadow: inset 2px 2px 0 #3a3a3a, inset -2px -2px 0 #242424, 0 4px 8px rgba(0,0,0,0.3);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            border-radius: 0;
        }

        .toast.success {
            border-left: 4px solid #3a8b4a;
        }

        .toast.error {
            border-left: 4px solid #8b3a3a;
        }

        .toast.info {
            border-left: 4px solid #3453df;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            font-size: 20px;
        }

        .toast.success .toast-icon {
            color: #3a8b4a;
        }

        .toast.error .toast-icon {
            color: #8b3a3a;
        }

        .toast.info .toast-icon {
            color: #3453df;
        }

        .toast-message {
            color: #e6e6e6;
            font-size: 14px;
        }

        .progress-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 3000;
    align-items: center;
    justify-content: center;
}

.progress-overlay.show {
    display: flex;
    animation: fadeIn 0.2s ease;
}

.progress-box {
    background: #2e2e2e;
    border: 2px solid #1a1a1a;
    padding: 30px 40px;
    min-width: 350px;
    box-shadow: inset 2px 2px 0 #3a3a3a, inset -2px -2px 0 #242424, 0 4px 20px rgba(0,0,0,0.5);
    text-align: center;
}

.progress-title {
    color: #3453df;
    font-size: 20px;
    font-family: 'Minecraft Ten', 'Inter', sans-serif;
    margin-bottom: 20px;
}

.progress-bar-container {
    width: 100%;
    height: 30px;
    background: #1a1a1a;
    border: 2px solid #0a0a0a;
    box-shadow: inset 1px 1px 0 #2a2a2a;
    margin-bottom: 15px;
    overflow: hidden;
}

.progress-bar-fill {
    height: 100%;
    background: #3453df;
    width: 0%;
    transition: width 0.3s ease;
    box-shadow: inset 1px 1px 0 #5a73ff;
    position: relative;
}

.progress-bar-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
        90deg,
        transparent,
        transparent 10px,
        rgba(255, 255, 255, 0.1) 10px,
        rgba(255, 255, 255, 0.1) 20px
    );
    animation: progress-stripes 1s linear infinite;
}

@keyframes progress-stripes {
    0% { background-position: 0 0; }
    100% { background-position: 20px 0; }
}

.progress-text {
    color: #e6e6e6;
    font-size: 14px;
    margin-bottom: 5px;
}

.progress-percentage {
    color: #3453df;
    font-size: 24px;
    font-family: 'Minecraft Ten', 'Inter', sans-serif;
}

        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .mod-bulk-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.mod-individual-bulk-actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
    padding-top: 10px;
    border-top: 1px solid #1a1a1a;
}

        .undo-redo-controls {
    display: flex;
    gap: 10px;
}

.minecraft-button.undo-redo {
    height: 35px;
    min-width: 100px;
}

.minecraft-button.undo-redo:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.minecraft-button.undo-redo:disabled .minecraft-button-section {
    background: #2a2a2a;
}

.minecraft-button.undo-redo:disabled:hover .minecraft-button-section {
    background: #2a2a2a;
}

        .minecraft-button.bulk {
    height: 40px;
    min-width: 220px;
}

.minecraft-button.bulk .minecraft-button-name {
    font-size: 14px;
}

        .minecraft-button.thick {
            height: 50px;
        }

        .minecraft-button.thick .minecraft-button-name {
            font-size: 16px;
        }

        .help-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: none;
            user-select: none;
            background: none;
            padding: 0;
            z-index: 100;
        }

        .help-button-left-outline {
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            bottom: 0;
            background: #1e1e1e;
            z-index: 5;
            transition: transform 0.15s ease;
        }

        .help-button-right-outline {
            position: absolute;
            top: 0;
            right: 0;
            width: 2px;
            bottom: 0;
            background: #1e1e1e;
            z-index: 5;
            transition: transform 0.15s ease;
        }

        .help-button-section {
            flex: 1;
            background: #48494a;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 1px 1px 0 #6c6d6d, inset -1px -1px 0 #5b5c5c;
            overflow: hidden;
            z-index: 2;
            transition: transform 0.15s ease;
            margin: 0 2px;
            margin-bottom: 0;
            border-top: 2px solid #1e1e1e;
        }

        .help-button-dark-strip {
            height: 8px;
            background: #3b3c3c;
            position: relative;
            z-index: 2;
            transition: transform 0.15s ease, opacity 0.15s ease;
            margin: 0 2px;
            margin-top: 0;
        }

        .help-button-bottom-outline {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #1e1e1e;
            z-index: 5;
        }

        .help-button-shadow {
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #1a1a1a;
            z-index: 1;
            transition: transform 0.15s ease, opacity 0.15s ease;
        }

        .help-button-text {
            color: white;
            font-size: 32px;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.8);
            position: relative;
            z-index: 2;
        }

        .help-button.pressed .help-button-section {
            transform: translateY(6px);
        }

        .help-button.pressed .help-button-left-outline,
        .help-button.pressed .help-button-right-outline {
            transform: translateY(6px);
        }

        .help-button.pressed .help-button-dark-strip,
        .help-button.pressed .help-button-shadow {
            transform: translateY(3px);
            opacity: 0;
        }

        .help-button:hover .help-button-section {
            background: #414242;
        }

        .help-button:hover .help-button-dark-strip {
            background: #323333;
        }

        .help-modal {
            background: #2e2e2e;
            border: 2px solid #1a1a1a;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: inset 2px 2px 0 #3a3a3a, inset -2px -2px 0 #242424, 0 4px 20px rgba(0,0,0,0.5);
        }

        .help-modal-header {
            padding: 20px;
            border-bottom: 2px solid #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .help-modal-title {
            color: #3453df;
            font-size: 22px;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
        }

        .help-modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
            font-family: 'Nunito', sans-serif;
            line-height: 1.8;
            font-size: 15px;
            color: #e6e6e6;
        }

        .help-modal-body h3 {
            color: #3453df;
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            font-family: 'Minecraft Ten', 'Inter', sans-serif;
        }

        .help-modal-body h3:first-child {
            margin-top: 0;
        }

        .help-modal-body p {
            margin-bottom: 15px;
        }

        .help-modal-body ol, .help-modal-body ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .help-modal-body li {
            margin-bottom: 8px;
        }

        .help-modal-body strong {
            color: #3453df;
        }

        .help-modal-body code {
            background: #1a1a1a;
            padding: 2px 6px;
            color: #3453df;
            font-family: 'Courier New', monospace;
        }

        .header {
            background: rgba(45, 45, 45, 0.9);
            border-bottom: 3px solid #4a4a4a;
            padding: 15px 0;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 100;
            margin-bottom: 20px;
        }

        .header-content {
            max-width: 95vw;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
        }

        .logo {
            height: 60px;
            width: auto;
        }

        .logo img {
            height: 100%;
            width: auto;
            object-fit: contain;
        }

        img {
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .main-wrapper {
            padding: 20px;
        }

        .preview-grid::-webkit-scrollbar {
            width: 8px;
        }

        .preview-grid::-webkit-scrollbar-track {
            background: #242424;
        }

        .preview-grid::-webkit-scrollbar-thumb {
            background: #4f5a75;
            border-radius: 4px;
        }

        .preview-grid::-webkit-scrollbar-thumb:hover {
            background: #5a6580;
        }

        .file-explanation {
    margin-top: 6px;
    font-size: 14px;
    color: #999999;
    font-style: italic;
    line-height: 1.4;
    white-space: normal;
    word-break: break-word;
}


        @media (max-width: 768px) {
    .container {
        padding: 20px;
    }

    .checkbox-group {
        grid-template-columns: 1fr;
    }

    .button-row {
        flex-direction: column;
        align-items: center;
    }

    .minecraft-button {
        width: 100%;
        max-width: 300px;
    }

    .help-button {
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
    }

    .help-button-text {
        font-size: 28px;
    }

    .modal {
        width: 95%;
    }

    .help-modal {
        width: 95%;
    }

    .bulk-actions,
    .mod-bulk-actions,
    .mod-individual-bulk-actions {
        flex-direction: column;
        align-items: stretch;
    }

    .minecraft-button.bulk {
        width: 100%;
        max-width: none;
    }

    .undo-redo-controls {
        flex-direction: row;
        gap: 5px;
    }

    .minecraft-button.undo-redo {
        min-width: 80px;
    }

    .summary-stats {
        flex-direction: column;
        gap: 15px;
    }

    .stat-item {
        width: 100%;
    }

    .toast-container {
        right: 10px;
        left: 10px;
        max-width: none;
    }

    .toast {
        min-width: auto;
        width: 100%;
    }

    .progress-box {
        min-width: auto;
        width: 90%;
        padding: 20px 25px;
    }

    .mod-entry-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }

    .mod-entry-title {
        width: 100%;
    }

    .minecraft-button.small.danger {
        width: 100%;
        max-width: none;
    }

    .undo-redo-controls {
        flex-direction: row;
        gap: 5px;
        justify-content: center;
    }

    .minecraft-button.undo-redo {
        min-width: 80px;
        flex: 1;
    }

    .modal-footer {
        flex-direction: column;
        gap: 10px !important;
    }

    .modal-footer .minecraft-button {
        width: 100%;
        max-width: none;
    }

    .section-content > div[style*="display: flex"] {
        flex-direction: column !important;
        align-items: flex-start !important;
    }

    .section-content > div[style*="display: flex"] .undo-redo-controls {
        width: 100%;
        margin-top: 10px;
    }

    .page-title {
        font-size: 20px;
    }

    .section h2 {
        font-size: 16px;
    }

    label {
        font-size: 13px;
    }

    .chip {
        font-size: 12px;
        padding: 5px 10px;
    }

    .help-button {
        bottom: 15px;
        right: 15px;
        width: 45px;
        height: 45px;
    }

    .help-button-text {
        font-size: 24px;
    }

    .download-info {
        font-size: 14px;
    }

    .stat-number {
        font-size: 22px;
    }

    .stat-label {
        font-size: 12px;
    }
}
    </style>
</head>
<body>
<div class="header">
    <div class="header-content">
        <div class="logo">
            <a href="https://potatowolfie.github.io">
                <img src="assets/home/logo.png" alt="PotatoWolfie">
            </a>
        </div>
    </div>
</div>

<div class="main-wrapper">
    <div class="container">
        <h1 class="page-title">Trimmed armor Item Model Generator</h1>

        <div class="section">
            <div class="section-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="margin-bottom: 0;">Main Mod Configuration</h2>
                    <div class="undo-redo-controls" style="margin-bottom: 0;">
                        <button class="minecraft-button undo-redo small" id="undoBtn" onclick="undo()" disabled>
                            <div class="minecraft-button-left-outline"></div>
                            <div class="minecraft-button-right-outline"></div>
                            <div class="minecraft-button-section">
                                <div class="minecraft-button-name">↶ Undo</div>
                            </div>
                            <div class="minecraft-button-dark-strip"></div>
                            <div class="minecraft-button-bottom-outline"></div>
                            <div class="minecraft-button-shadow"></div>
                        </button>
                        <button class="minecraft-button undo-redo small" id="redoBtn" onclick="redo()" disabled>
                            <div class="minecraft-button-left-outline"></div>
                            <div class="minecraft-button-right-outline"></div>
                            <div class="minecraft-button-section">
                                <div class="minecraft-button-name">↷ Redo</div>
                            </div>
                            <div class="minecraft-button-dark-strip"></div>
                            <div class="minecraft-button-bottom-outline"></div>
                            <div class="minecraft-button-shadow"></div>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="modId">Mod ID:</label>
                    <div class="input-wrapper">
                        <input type="text" id="modId" value="" placeholder="your-mod-id" autocomplete="off">
                        <div class="validation-icon" id="modIdWarning">⚠</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="customMaterialInput">Custom Materials:</label>
                    <input type="text" id="customMaterialInput" placeholder="Enter material name and press Enter" autocomplete="off">
                    <div class="chip-container" id="customMaterials"></div>
                </div>
                <div class="form-group">
                    <label for="customArmorInput">Custom Armor Types:</label>
                    <input type="text" id="customArmorInput" placeholder="Enter armor type and press Enter" autocomplete="off">
                    <div class="chip-container" id="customArmors"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-content">
                <h2>Armor Types</h2>
                <div class="bulk-actions">
                    <button class="minecraft-button bulk" onclick="bulkSelectArmor(true)">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">Select All</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                    <button class="minecraft-button bulk" onclick="bulkSelectArmor(false)">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">Deselect All</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                </div>
                <div class="checkbox-group" id="armorTypes">
                    <label class="checkbox-label">
                        <input type="checkbox" value="leather" checked> Leather
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="chainmail" checked> Chainmail
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="iron" checked> Iron
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="golden" checked> Golden
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="diamond" checked> Diamond
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="netherite" checked> Netherite
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="copper" checked> Copper
                    </label>
                </div>
                <div id="modArmorTypesSection"></div>
            </div>
        </div>

        <div class="section">
            <div class="section-content">
                <h2>Additional Mods Support</h2>
                <p style="margin-bottom: 15px; color: #a0a0a0; font-size: 14px;">Add other mods' armor types to generate trim models for them too.</p>

                <div class="mod-bulk-actions" id="modBulkActions" style="display: none;">
                    <button class="minecraft-button bulk" onclick="bulkSelectAllMods(true)">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">Select All Armors</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                    <button class="minecraft-button bulk" onclick="bulkSelectAllMods(false)">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">Deselect All Armors</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                    <button class="minecraft-button bulk danger" onclick="bulkRemoveAllMods()">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">Remove All Mods</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                </div>

                <div id="additionalMods"></div>
                <button class="minecraft-button small" onclick="addModEntry()">
                    <div class="minecraft-button-left-outline"></div>
                    <div class="minecraft-button-right-outline"></div>
                    <div class="minecraft-button-section">
                        <div class="minecraft-button-name">+ Add Mod</div>
                    </div>
                    <div class="minecraft-button-dark-strip"></div>
                    <div class="minecraft-button-bottom-outline"></div>
                    <div class="minecraft-button-shadow"></div>
                </button>
            </div>
        </div>

        <div class="button-row">
            <button class="minecraft-button" onclick="saveConfiguration()">
                <div class="minecraft-button-left-outline"></div>
                <div class="minecraft-button-right-outline"></div>
                <div class="minecraft-button-section">
                    <div class="minecraft-button-name">Save Configuration</div>
                </div>
                <div class="minecraft-button-dark-strip"></div>
                <div class="minecraft-button-bottom-outline"></div>
                <div class="minecraft-button-shadow"></div>
            </button>
            <button class="minecraft-button" onclick="document.getElementById('loadConfigInput').click()">
                <div class="minecraft-button-left-outline"></div>
                <div class="minecraft-button-right-outline"></div>
                <div class="minecraft-button-section">
                    <div class="minecraft-button-name">Load Configuration</div>
                </div>
                <div class="minecraft-button-dark-strip"></div>
                <div class="minecraft-button-bottom-outline"></div>
                <div class="minecraft-button-shadow"></div>
            </button>
            <input type="file" id="loadConfigInput" accept=".json" style="display: none;" onchange="loadConfiguration(event)">
        </div>

        <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; justify-content: center; align-items: center;">
            <label class="checkbox-label" style="margin: 0;">
                <input type="checkbox" id="atlasCheckbox" onchange="generateAtlases = this.checked" checked>
                Generate Atlas Files
            </label>
            <button class="minecraft-button" onclick="showArmorSlotCustomizationModal()">
                <div class="minecraft-button-left-outline"></div>
                <div class="minecraft-button-right-outline"></div>
                <div class="minecraft-button-section">
                    <div class="minecraft-button-name">Customize Armor Slots</div>
                </div>
                <div class="minecraft-button-dark-strip"></div>
                <div class="minecraft-button-bottom-outline"></div>
                <div class="minecraft-button-shadow"></div>
            </button>
        </div>

        <button class="minecraft-button success" onclick="generateModels()" style="margin-top: 20px; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto; display: flex;">
            <div class="minecraft-button-left-outline"></div>
            <div class="minecraft-button-right-outline"></div>
            <div class="minecraft-button-section">
                <div class="minecraft-button-name">Generate Models</div>
            </div>
            <div class="minecraft-button-dark-strip"></div>
            <div class="minecraft-button-bottom-outline"></div>
            <div class="minecraft-button-shadow"></div>
        </button>

        <div class="download-section" id="downloadSection">
            <div class="download-content">
                <div class="download-info">Your models are ready!</div>
                <div class="file-size" id="fileSize">0 KB</div>
                <div class="summary-stats" id="summaryStats"></div>

                <button class="minecraft-button success" onclick="downloadZip()">
                    <div class="minecraft-button-left-outline"></div>
                    <div class="minecraft-button-right-outline"></div>
                    <div class="minecraft-button-section">
                        <div class="minecraft-button-name">Download ZIP</div>
                    </div>
                    <div class="minecraft-button-dark-strip"></div>
                    <div class="minecraft-button-bottom-outline"></div>
                    <div class="minecraft-button-shadow"></div>
                </button>

                <div class="directory-info" id="directoryInfo"></div>

                <div class="preview-dropdown" id="previewDropdown">
                    <div class="preview-header" onclick="togglePreview()">
                        <div class="preview-header-text">Preview Generated Files</div>
                        <div class="preview-header-arrow" id="previewArrow">
                            <img src="assets/wiki/buttons/dropdown_arrow.png" alt="Dropdown Arrow">
                        </div>
                    </div>
                    <div class="preview-grid" id="previewGrid">
                        <div class="preview-content">
                            <div class="search-container">
                                <input type="text" class="search-box" id="previewSearch" placeholder="Search files..." oninput="filterPreviewFiles()" autocomplete="off">
                            </div>
                            <div class="file-list" id="fileList"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">File Preview</div>
            <button class="modal-close" onclick="closeModal()">
                <img src="assets/buttons/exit.png" alt="Close">
            </button>
        </div>
        <div class="modal-body">
            <pre id="modalContent"></pre>
        </div>
        <div class="modal-footer">
            <button class="minecraft-button thick success" onclick="copyToClipboard()">
                <div class="minecraft-button-left-outline"></div>
                <div class="minecraft-button-right-outline"></div>
                <div class="minecraft-button-section">
                    <div class="minecraft-button-name">Copy to Clipboard</div>
                </div>
                <div class="minecraft-button-dark-strip"></div>
                <div class="minecraft-button-bottom-outline"></div>
                <div class="minecraft-button-shadow"></div>
            </button>
        </div>
    </div>
</div>

<div class="help-button" onclick="showHelp()">
    <div class="help-button-left-outline"></div>
    <div class="help-button-right-outline"></div>
    <div class="help-button-section">
        <div class="help-button-text">?</div>
    </div>
    <div class="help-button-dark-strip"></div>
    <div class="help-button-bottom-outline"></div>
    <div class="help-button-shadow"></div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
    const VANILLA_MATERIALS = [
        ["minecraft", "quartz"], ["minecraft", "iron"], ["minecraft", "netherite"],
        ["minecraft", "redstone"], ["minecraft", "copper"], ["minecraft", "gold"],
        ["minecraft", "emerald"], ["minecraft", "diamond"], ["minecraft", "lapis"],
        ["minecraft", "amethyst"], ["minecraft", "resin"]
    ];

    const ARMOR_SLOTS = ["helmet", "chestplate", "leggings", "boots"];

    let customMaterials = [];
    let customArmors = [];
    let additionalMods = [];
    let generatedZip = null;
    let generatedFiles = {};
    let previewRotation = 0;
    let currentModalFile = '';
    let undoStack = [];
    let redoStack = [];
    let generateAtlases = true;
    let customArmorSlots = {};
    const MAX_UNDO_HISTORY = 20;

    function showToast(message, type = 'info') {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;

        const icon = type === 'success' ? '✓' : type === 'error' ? '✕' : 'ℹ';
        toast.innerHTML = `
            <div class="toast-icon">${icon}</div>
            <div class="toast-message">${message}</div>
        `;

        container.appendChild(toast);

        setTimeout(() => {
            toast.style.animation = 'slideInRight 0.3s ease reverse';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    document.getElementById('modId').addEventListener('input', function(e) {
        this.value = this.value.toLowerCase();
    });

    document.getElementById('customMaterialInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const value = this.value.trim().toLowerCase();
            if (value && !customMaterials.includes(value)) {
                saveState();
                customMaterials.push(value);
                renderMaterials();
                this.value = '';
                showToast('Material added!', 'success');
            }
        }
    });

    document.getElementById('customMaterialInput').addEventListener('input', function(e) {
        this.value = this.value.toLowerCase();
    });

    function removeMaterial(material) {
    saveState();
        customMaterials = customMaterials.filter(m => m !== material);
        renderMaterials();
        showToast('Material removed', 'info');
    }

    function renderMaterials() {
        document.getElementById('customMaterials').innerHTML = customMaterials.map(m =>
            `<div class="chip">${m} <button onclick="removeMaterial('${m}')">×</button></div>`
        ).join('');
    }

    document.getElementById('customArmorInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const value = this.value.trim().toLowerCase();
            if (value && !customArmors.includes(value)) {
                saveState();
                customArmors.push(value);
                renderCustomArmors();
                this.value = '';
                showToast('Armor type added!', 'success');
            }
        }
    });

    document.getElementById('customArmorInput').addEventListener('input', function(e) {
        this.value = this.value.toLowerCase();
    });

    function removeCustomArmor(armor) {
    saveState();
        customArmors = customArmors.filter(a => a !== armor);
        additionalMods.forEach(mod => {
            mod.armorTypes = mod.armorTypes.filter(a => a !== armor);
        });
        renderCustomArmors();
        showToast('Armor type removed', 'info');
    }

    function renderCustomArmors() {
        document.getElementById('customArmors').innerHTML = customArmors.map(a =>
            `<div class="chip">${a} <button onclick="removeCustomArmor('${a}')">×</button></div>`
        ).join('');
        updateMainModArmorTypes();
        if (additionalMods.length > 0) {
            renderAdditionalMods();
        }
    }

    function updateMainModArmorTypes() {
        const modArmorTypes = getAllModArmorTypes();
        const modArmorSection = document.getElementById('modArmorTypesSection');

        if (modArmorTypes.length > 0) {
            modArmorSection.innerHTML = `
                <h3 style="color: #3453df; margin-top: 15px; margin-bottom: 10px; font-size: 16px; font-family: 'Minecraft Ten', 'Inter', sans-serif;">Mod Armor Types</h3>
                <div class="bulk-actions">
                    <button class="minecraft-button bulk" onclick="bulkSelectModArmor(true)">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">Select All</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                    <button class="minecraft-button bulk" onclick="bulkSelectModArmor(false)">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">Deselect All</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                </div>
                <div class="checkbox-group">
                    ${modArmorTypes.map(armorType => `
                        <label class="checkbox-label">
                            <input type="checkbox" value="${armorType}" checked>
                            ${armorType.charAt(0).toUpperCase() + armorType.slice(1)}
                        </label>
                    `).join('')}
                </div>
            `;
            attachButtonAnimations();
        } else {
            modArmorSection.innerHTML = '';
        }
    }

    function bulkSelectArmor(select) {
        const checkboxes = document.querySelectorAll('#armorTypes input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = select);
        showToast(select ? 'All vanilla armors selected' : 'All vanilla armors deselected', 'info');
    }

    function bulkSelectModArmor(select) {
        const checkboxes = document.querySelectorAll('#modArmorTypesSection input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = select);
        showToast(select ? 'All mod armors selected' : 'All mod armors deselected', 'info');
    }

    function addModEntry() {
    const id = Date.now();
    additionalMods.push({
        id,
        modId: '',
        armorTypes: [],
        customMaterials: [],
        customArmorInputs: []
    });
    renderAdditionalMods();
    showToast('Mod entry added', 'success');
}

    function removeModEntry(id) {
    saveState();
        additionalMods = additionalMods.filter(m => m.id !== id);
        renderAdditionalMods();
        showToast('Mod removed', 'info');
    }

    function updateModId(id, value) {
        const mod = additionalMods.find(m => m.id === id);
        if (mod) mod.modId = value;
    }

    function addMaterialToMod(id, e) {
        if (e.key === 'Enter') {
            const value = e.target.value.trim().toLowerCase();
            const mod = additionalMods.find(m => m.id === id);
            if (mod && value && !mod.customMaterials.includes(value)) {
                mod.customMaterials.push(value);
                renderAdditionalMods();
                e.target.value = '';
                showToast('Material added to mod', 'success');
            }
        }
    }

    function removeMaterialFromMod(modId, material) {
        const mod = additionalMods.find(m => m.id === modId);
        if (mod) {
            mod.customMaterials = mod.customMaterials.filter(m => m !== material);
            renderAdditionalMods();
            showToast('Material removed from mod', 'info');
        }
    }

    function addArmorToMod(id, e) {
    if (e.key === 'Enter') {
        const value = e.target.value.trim().toLowerCase();
        const mod = additionalMods.find(m => m.id === id);
        if (mod && value) {
            if (!mod.customArmorInputs) mod.customArmorInputs = [];

            if (!mod.customArmorInputs.includes(value)) {
                saveState();
                mod.customArmorInputs.push(value);
                if (!mod.armorTypes.includes(value)) {
                    mod.armorTypes.push(value);
                }
                renderAdditionalMods();
                e.target.value = '';
                showToast('Armor type added to mod', 'success');
            }
        }
    }
}

    function removeArmorFromMod(modId, armor) {
    const mod = additionalMods.find(m => m.id === modId);
    if (mod) {
        mod.armorTypes = mod.armorTypes.filter(a => a !== armor);
        if (mod.customArmorInputs) {
            mod.customArmorInputs = mod.customArmorInputs.filter(a => a !== armor);
        }
        renderAdditionalMods();
        showToast('Armor type removed from mod', 'info');
    }
}

    function toggleModArmor(modId, armorType, checked) {
    const mod = additionalMods.find(m => m.id === modId);
    if (mod) {
        if (checked && !mod.armorTypes.includes(armorType)) {
            mod.armorTypes.push(armorType);
        } else if (!checked) {
            mod.armorTypes = mod.armorTypes.filter(a => a !== armorType);
        }
    }
}

    function getAllModArmorTypes() {
    const vanillaArmors = ['leather', 'chainmail', 'iron', 'golden', 'diamond', 'netherite', 'copper'];
    const modArmors = new Set();

    customArmors.forEach(armor => {
        if (!vanillaArmors.includes(armor)) modArmors.add(armor);
    });

    additionalMods.forEach(mod => {
        (mod.customArmorInputs || []).forEach(armor => {
            if (!vanillaArmors.includes(armor)) {
                modArmors.add(armor);
            }
        });
    });

    return Array.from(modArmors);
}

    function bulkSelectAllMods(select) {
    const vanillaArmors = getSelectedArmorTypes();
    const modArmors = getAllModArmorTypes();

    additionalMods.forEach(mod => {
        const customInputs = mod.customArmorInputs || [];
        if (select) {
            mod.armorTypes = [...new Set([...vanillaArmors, ...modArmors, ...customInputs])];
        } else {
            mod.armorTypes = [...customInputs];
        }
    });

    renderAdditionalMods();
    showToast(select ? 'All armors selected for all mods' : 'All armors deselected for all mods', 'info');
}

function bulkAddMaterialToAllMods() {
    const material = prompt('Enter material name to add to all mods:');
    if (!material) return;

    const materialLower = material.trim().toLowerCase();
    let addedCount = 0;

    additionalMods.forEach(mod => {
        if (!mod.customMaterials) mod.customMaterials = [];
        if (!mod.customMaterials.includes(materialLower)) {
            mod.customMaterials.push(materialLower);
            addedCount++;
        }
    });

    if (addedCount > 0) {
        saveState();
        renderAdditionalMods();
        showToast(`Added "${materialLower}" to ${addedCount} mod(s)`, 'success');
    } else {
        showToast('Material already exists in all mods', 'info');
    }
}

function bulkRemoveAllMods() {
    if (additionalMods.length === 0) return;

    const modalOverlay = document.createElement('div');
    modalOverlay.className = 'modal-overlay show';
    modalOverlay.style.zIndex = '3000';

    modalOverlay.innerHTML = `
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 550px;">
            <div class="modal-header">
                <div class="modal-title">Confirm Removal</div>
                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">
                    <img src="assets/buttons/exit.png" alt="Close">
                </button>
            </div>
            <div class="modal-body">
                <p style="margin: 0; font-size: 16px; line-height: 1.6;">
                    Are you sure you want to remove all <strong style="color: #3453df;">${additionalMods.length}</strong> mod entries?
                </p>
                <p style="margin-top: 10px; color: #a0a0a0; font-size: 14px;">
                    This action can be undone with the Undo button at the top.
                </p>
            </div>
            <div class="modal-footer" style="gap: 10px; justify-content: center;">
                <button class="minecraft-button" onclick="this.closest('.modal-overlay').remove()">
                    <div class="minecraft-button-left-outline"></div>
                    <div class="minecraft-button-right-outline"></div>
                    <div class="minecraft-button-section">
                        <div class="minecraft-button-name">Cancel</div>
                    </div>
                    <div class="minecraft-button-dark-strip"></div>
                    <div class="minecraft-button-bottom-outline"></div>
                    <div class="minecraft-button-shadow"></div>
                </button>
                <button class="minecraft-button danger" onclick="confirmBulkRemove(this)">
                    <div class="minecraft-button-left-outline"></div>
                    <div class="minecraft-button-right-outline"></div>
                    <div class="minecraft-button-section">
                        <div class="minecraft-button-name">Remove All</div>
                    </div>
                    <div class="minecraft-button-dark-strip"></div>
                    <div class="minecraft-button-bottom-outline"></div>
                    <div class="minecraft-button-shadow"></div>
                </button>
            </div>
        </div>
    `;

    document.body.appendChild(modalOverlay);
    attachButtonAnimations();
}

function confirmBulkRemove(button) {
    saveState();
    additionalMods = [];
    renderAdditionalMods();
    showToast('All mods removed', 'info');
    button.closest('.modal-overlay').remove();
}

function selectAllArmorsForMod(modId) {
    const mod = additionalMods.find(m => m.id === modId);
    if (!mod) return;

    const vanillaArmors = getSelectedArmorTypes();
    const modArmors = getAllModArmorTypes();
    const customInputs = mod.customArmorInputs || [];

    mod.armorTypes = [...new Set([...vanillaArmors, ...modArmors, ...customInputs])];
    renderAdditionalMods();
    showToast('All armors selected for this mod', 'info');
}

function deselectAllArmorsForMod(modId) {
    const mod = additionalMods.find(m => m.id === modId);
    if (!mod) return;

    const customInputs = mod.customArmorInputs || [];
    mod.armorTypes = [...customInputs];

    renderAdditionalMods();
    showToast('All armors deselected for this mod', 'info');
}

    function renderAdditionalMods() {
    const bulkActionsDiv = document.getElementById('modBulkActions');
    if (bulkActionsDiv) {
        bulkActionsDiv.style.display = additionalMods.length > 0 ? 'flex' : 'none';
    }

    updateMainModArmorTypes();
    const vanillaArmorTypes = ['leather', 'chainmail', 'iron', 'golden', 'diamond', 'netherite', 'copper'];
const allArmorTypes = vanillaArmorTypes;
    const modArmorTypes = getAllModArmorTypes();

    document.getElementById('additionalMods').innerHTML = additionalMods.map(mod => {
        return `
        <div class="mod-entry"
             ontouchstart="handleTouchStart(event, ${mod.id})"
             ontouchmove="handleTouchMove(event)"
             ontouchend="handleTouchEnd(event, ${mod.id})">
            <div class="mod-entry-header">
                <div class="mod-entry-title">
                    <div class="drag-handle" data-id="${mod.id}">
                        <img src="assets/buttons/drag.png" alt="Drag">
                    </div>
                    <strong>Mod ${additionalMods.indexOf(mod) + 1}</strong>
                </div>
                <button class="minecraft-button small danger" onclick="removeModEntry(${mod.id})">
                    <div class="minecraft-button-left-outline"></div>
                    <div class="minecraft-button-right-outline"></div>
                    <div class="minecraft-button-section">
                        <div class="minecraft-button-name">Remove</div>
                    </div>
                    <div class="minecraft-button-dark-strip"></div>
                    <div class="minecraft-button-bottom-outline"></div>
                    <div class="minecraft-button-shadow"></div>
                </button>
            </div>

            <div class="form-group">
                <label>Mod ID:</label>
                <input type="text"
                       value="${mod.modId}"
                       oninput="this.value = this.value.toLowerCase(); updateModId(${mod.id}, this.value)"
                       placeholder="other-mod-id"
                       autocomplete="off">
            </div>

            <div class="form-group">
                <label>Custom Materials for this mod:</label>
                <input type="text"
                       oninput="this.value = this.value.toLowerCase()"
                       onkeypress="addMaterialToMod(${mod.id}, event)"
                       placeholder="Enter material name and press Enter"
                       autocomplete="off">
                ${mod.customMaterials && mod.customMaterials.length > 0 ? `
                    <div class="chip-container">
                        ${mod.customMaterials.map(material =>
                            `<div class="chip">${material}
                                <button onclick="event.stopPropagation(); removeMaterialFromMod(${mod.id}, '${material}')">×</button>
                             </div>`
                        ).join('')}
                    </div>
                ` : ''}
            </div>

            <div class="form-group">
                <label>Custom Armor Types for this mod:</label>
                <input type="text"
                       oninput="this.value = this.value.toLowerCase()"
                       onkeypress="addArmorToMod(${mod.id}, event)"
                       placeholder="Enter armor type and press Enter"
                       autocomplete="off">
                ${mod.customArmorInputs && mod.customArmorInputs.length > 0 ? `
                    <div class="chip-container">
                        ${mod.customArmorInputs.map(armor =>
                            `<div class="chip">${armor}
                                <button onclick="event.stopPropagation(); removeArmorFromMod(${mod.id}, '${armor}')">×</button>
                             </div>`
                        ).join('')}
                    </div>
                ` : ''}
            </div>

            <div class="form-group">
                <label>Armor Types:</label>
                <div class="mod-individual-bulk-actions">
                    <button class="minecraft-button bulk" onclick="selectAllArmorsForMod(${mod.id})">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">Select All</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                    <button class="minecraft-button bulk" onclick="deselectAllArmorsForMod(${mod.id})">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">Deselect All</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                </div>

                <div class="checkbox-group">
                    ${allArmorTypes.map(armorType => `
                        <label class="checkbox-label">
                            <input type="checkbox" value="${armorType}"
                                   ${mod.armorTypes.includes(armorType) ? 'checked' : ''}
                                   onchange="toggleModArmor(${mod.id}, '${armorType}', this.checked)">
                            ${armorType.charAt(0).toUpperCase() + armorType.slice(1)}
                        </label>
                    `).join('')}
                </div>

                ${modArmorTypes.length > 0 ? `
                    <h3 style="color: #3453df; margin-top: 15px; margin-bottom: 10px; font-size: 16px; font-family: 'Minecraft Ten', 'Inter', sans-serif;">
                        Mod Armor Types
                    </h3>
                    <div class="checkbox-group">
                        ${modArmorTypes.map(armorType => `
                            <label class="checkbox-label">
                                <input type="checkbox" value="${armorType}"
                                       ${mod.armorTypes.includes(armorType) ? 'checked' : ''}
                                       onchange="toggleModArmor(${mod.id}, '${armorType}', this.checked)">
                                ${armorType.charAt(0).toUpperCase() + armorType.slice(1)}
                            </label>
                        `).join('')}
                    </div>
                ` : ''}
            </div>
        </div>`;
    }).join('');

    attachButtonAnimations();
}


    function getSelectedArmorTypes() {
        const checkboxes = document.querySelectorAll('#armorTypes input[type="checkbox"]:checked');
        return Array.from(checkboxes).map(cb => cb.value);
    }

    function saveConfiguration() {
        const config = {
            modId: document.getElementById('modId').value,
            customMaterials,
            customArmors,
            selectedVanillaArmors: getSelectedArmorTypes(),
            selectedModArmors: Array.from(document.querySelectorAll('#modArmorTypesSection input[type="checkbox"]:checked')).map(cb => cb.value),
            additionalMods: additionalMods.map(mod => ({
                modId: mod.modId,
                armorTypes: mod.armorTypes,
                customMaterials: mod.customMaterials
            }))
        };

        const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
        saveAs(blob, 'armor_trim_config.json');
        showToast('Configuration saved!', 'success');
    }

    function loadConfiguration(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const config = JSON.parse(e.target.result);

                document.getElementById('modId').value = config.modId || '';
                customMaterials = config.customMaterials || [];
                customArmors = config.customArmors || [];
                additionalMods = config.additionalMods?.map(mod => ({
                    ...mod,
                    id: Date.now() + Math.random()
                })) || [];

                renderMaterials();
                renderCustomArmors();
                renderAdditionalMods();

                document.querySelectorAll('#armorTypes input[type="checkbox"]').forEach(cb => {
                    cb.checked = config.selectedVanillaArmors?.includes(cb.value) || false;
                });

                setTimeout(() => {
                    document.querySelectorAll('#modArmorTypesSection input[type="checkbox"]').forEach(cb => {
                        cb.checked = config.selectedModArmors?.includes(cb.value) || false;
                    });
                }, 100);

                showToast('Configuration loaded!', 'success');
            } catch (error) {
                showToast('Error loading configuration', 'error');
                console.error(error);
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    }

    function createSelectModel(armorType, slot, modId, materials) {
        const model = {
            type: "minecraft:select",
            cases: [],
            fallback: {
                type: "minecraft:model",
                model: `minecraft:item/${armorType}_${slot}`
            },
            property: "minecraft:trim_material"
        };

        if (armorType === 'leather') {
            model.fallback.tints = [{ type: "minecraft:dye", default: -6265536 }];
        }

        VANILLA_MATERIALS.forEach(([ns, mat]) => {
            const caseObj = {
                model: {
                    type: "minecraft:model",
                    model: `minecraft:item/${armorType}_${slot}_${mat}_trim`
                },
                when: `${ns}:${mat}`
            };
            if (armorType === 'leather') {
                caseObj.model.tints = [{ type: "minecraft:dye", default: -6265536 }];
            }
            model.cases.push(caseObj);
        });

        materials.forEach(mat => {
            const caseObj = {
                model: {
                    type: "minecraft:model",
                    model: `${modId}:item/${armorType}_${slot}_${mat}_trim`
                },
                when: `${modId}:${mat}`
            };
            if (armorType === 'leather') {
                caseObj.model.tints = [{ type: "minecraft:dye", default: -6265536 }];
            }
            model.cases.push(caseObj);
        });

        return { model };
    }

    function createTrimModel(armorType, slot, material) {
    const textureOverride = getArmorSlotTexture(armorType, slot);
    const texturePath = textureOverride !== slot ? textureOverride : `${armorType}_${slot}`;

    return {
        parent: "minecraft:item/generated",
        textures: {
            layer0: `minecraft:item/${texturePath}`,
            layer1: `minecraft:trims/items/${slot}_trim_${material}`
        }
    };
}

            function validateInputs() {
    let isValid = true;
    const modIdInput = document.getElementById('modId');
    const modIdWarning = document.getElementById('modIdWarning');

    if (!modIdInput.value.trim()) {
        modIdInput.classList.add('invalid');
        modIdWarning.classList.add('show');
        isValid = false;
        showToast('Mod ID is required', 'error');
    } else {
        modIdInput.classList.remove('invalid');
        modIdWarning.classList.remove('show');
    }

    const vanillaArmorTypes = getSelectedArmorTypes();
    const modArmorTypes = Array.from(
        document.querySelectorAll('#modArmorTypesSection input[type="checkbox"]:checked')
    ).map(cb => cb.value);

    if (vanillaArmorTypes.length === 0 && modArmorTypes.length === 0) {
        isValid = false;
        showToast('Please select at least one armor type (vanilla or mod)', 'error');
    }

    const hasCustomContent = customMaterials.length > 0 || customArmors.length > 0;
if (!hasCustomContent) {
    isValid = false;
    showToast('Please add at least one custom material OR custom armor type', 'error');
}

    return isValid;
}

function checkDuplicates() {
    const modId = document.getElementById('modId').value.trim().toLowerCase();
    const warnings = [];

    if (modId) {
        const duplicateMods = additionalMods.filter(mod =>
            mod.modId.toLowerCase() === modId
        );

        if (duplicateMods.length > 0) {
            warnings.push(`Mod ID "${modId}" is duplicated in additional mods`);
        }
    }

    const modIds = additionalMods.map(m => m.modId.toLowerCase()).filter(id => id);
    const duplicateModIds = modIds.filter((id, index) => modIds.indexOf(id) !== index);

    if (duplicateModIds.length > 0) {
        warnings.push(`Duplicate mod IDs: ${[...new Set(duplicateModIds)].join(', ')}`);
    }

    const materialDupes = customMaterials.filter((item, index) => customMaterials.indexOf(item) !== index);
    if (materialDupes.length > 0) {
        warnings.push(`Main mod has duplicate materials: ${[...new Set(materialDupes)].join(', ')}`);
    }

    const armorDupes = customArmors.filter((item, index) => customArmors.indexOf(item) !== index);
    if (armorDupes.length > 0) {
        warnings.push(`Main mod has duplicate armor types: ${[...new Set(armorDupes)].join(', ')}`);
    }

    additionalMods.forEach((mod, idx) => {
        if (mod.customMaterials) {
            const modMatDupes = mod.customMaterials.filter((item, index) => mod.customMaterials.indexOf(item) !== index);
            if (modMatDupes.length > 0) {
                warnings.push(`Mod ${idx + 1} (${mod.modId || 'unnamed'}) has duplicate materials: ${[...new Set(modMatDupes)].join(', ')}`);
            }
        }

        if (mod.customArmorInputs) {
            const modArmorDupes = mod.customArmorInputs.filter((item, index) => mod.customArmorInputs.indexOf(item) !== index);
            if (modArmorDupes.length > 0) {
                warnings.push(`Mod ${idx + 1} (${mod.modId || 'unnamed'}) has duplicate armor types: ${[...new Set(modArmorDupes)].join(', ')}`);
            }
        }
    });

    if (warnings.length > 0) {
        showDuplicateWarningModal(warnings);
        return false;
    }

    return true;
}

function showDuplicateWarningModal(warnings) {
    const modalOverlay = document.createElement('div');
    modalOverlay.className = 'modal-overlay show';
    modalOverlay.style.zIndex = '3000';

    const warningList = warnings.map(w => `<li>${w}</li>`).join('');

    modalOverlay.innerHTML = `
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div class="modal-header">
                <div class="modal-title">⚠ Duplicate Items Detected</div>
                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">
                    <img src="assets/buttons/exit.png" alt="Close">
                </button>
            </div>
            <div class="modal-body">
                <p style="margin: 0 0 15px 0; font-size: 16px; line-height: 1.6;">
                    The following duplicates were detected. This may cause issues with generation:
                </p>
                <ul style="margin: 0 0 15px 20px; color: #3453df; line-height: 1.8;">
                    ${warningList}
                </ul>
                <p style="margin: 0; color: #a0a0a0; font-size: 14px;">
                    Do you want to continue anyway?
                </p>
            </div>
            <div class="modal-footer" style="gap: 10px; justify-content: center;">
                <button class="minecraft-button" onclick="this.closest('.modal-overlay').remove()">
                    <div class="minecraft-button-left-outline"></div>
                    <div class="minecraft-button-right-outline"></div>
                    <div class="minecraft-button-section">
                        <div class="minecraft-button-name">Cancel</div>
                    </div>
                    <div class="minecraft-button-dark-strip"></div>
                    <div class="minecraft-button-bottom-outline"></div>
                    <div class="minecraft-button-shadow"></div>
                </button>
                <button class="minecraft-button success" onclick="proceedWithGeneration(this)">
                    <div class="minecraft-button-left-outline"></div>
                    <div class="minecraft-button-right-outline"></div>
                    <div class="minecraft-button-section">
                        <div class="minecraft-button-name">Continue Anyway</div>
                    </div>
                    <div class="minecraft-button-dark-strip"></div>
                    <div class="minecraft-button-bottom-outline"></div>
                    <div class="minecraft-button-shadow"></div>
                </button>
            </div>
        </div>
    `;

    document.body.appendChild(modalOverlay);
    attachButtonAnimations();
}

function proceedWithGeneration(button) {
    button.closest('.modal-overlay').remove();
    generateModelsAfterValidation();
}

function saveState() {
    const state = {
        customMaterials: [...customMaterials],
        customArmors: [...customArmors],
        additionalMods: JSON.parse(JSON.stringify(additionalMods))
    };

    undoStack.push(state);
    if (undoStack.length > MAX_UNDO_HISTORY) {
        undoStack.shift();
    }

    redoStack = [];
    updateUndoRedoButtons();
}

function undo() {
    if (undoStack.length === 0) return;

    const currentState = {
        customMaterials: [...customMaterials],
        customArmors: [...customArmors],
        additionalMods: JSON.parse(JSON.stringify(additionalMods))
    };

    redoStack.push(currentState);

    const previousState = undoStack.pop();
    customMaterials = previousState.customMaterials;
    customArmors = previousState.customArmors;
    additionalMods = previousState.additionalMods;

    renderMaterials();
    renderCustomArmors();
    renderAdditionalMods();
    updateUndoRedoButtons();
    showToast('Undone', 'info');
}

function redo() {
    if (redoStack.length === 0) return;

    const currentState = {
        customMaterials: [...customMaterials],
        customArmors: [...customArmors],
        additionalMods: JSON.parse(JSON.stringify(additionalMods))
    };

    undoStack.push(currentState);

    const nextState = redoStack.pop();
    customMaterials = nextState.customMaterials;
    customArmors = nextState.customArmors;
    additionalMods = nextState.additionalMods;

    renderMaterials();
    renderCustomArmors();
    renderAdditionalMods();
    updateUndoRedoButtons();
    showToast('Redone', 'info');
}

function updateUndoRedoButtons() {
    const undoBtn = document.getElementById('undoBtn');
    const redoBtn = document.getElementById('redoBtn');

    if (undoBtn) undoBtn.disabled = undoStack.length === 0;
    if (redoBtn) redoBtn.disabled = redoStack.length === 0;
}

function showProgress() {
    document.getElementById('progressOverlay').classList.add('show');
    updateProgress(0, 'Starting generation...');
}

function hideProgress() {
    setTimeout(() => {
        document.getElementById('progressOverlay').classList.remove('show');
    }, 500);
}

function updateProgress(percentage, text) {
    document.getElementById('progressBarFill').style.width = percentage + '%';
    document.getElementById('progressPercentage').textContent = Math.round(percentage) + '%';
    document.getElementById('progressText').textContent = text;
}

    async function generateModels() {
    if (!validateInputs()) {
        return;
    }

    const duplicatesExist = !checkDuplicates();
    if (duplicatesExist) {
        return;
    }

    await generateModelsAfterValidation();
}

async function generateModelsAfterValidation() {
    showProgress();
    await new Promise(resolve => setTimeout(resolve, 100));

    const modId = document.getElementById('modId').value;
    const armorTypes = getSelectedArmorTypes();
    const modArmorTypes = Array.from(
        document.querySelectorAll('#modArmorTypesSection input[type="checkbox"]:checked')
    ).map(cb => cb.value);
    const allSelectedArmors = [...armorTypes, ...modArmorTypes];

    updateProgress(10, 'Calculating files to generate...');
    await new Promise(resolve => setTimeout(resolve, 100));

    const zip = new JSZip();
    generatedFiles = {};

    const selectFolder = zip.folder('VanillaItems');
    const mainModFolder = zip.folder(`${modId}-CustomLayeredItem`);

    const vanillaArmors = ['leather', 'chainmail', 'iron', 'golden', 'diamond', 'netherite', 'copper'];
    const selectedVanillaArmors = allSelectedArmors.filter(armor => vanillaArmors.includes(armor));

    const totalVanillaOps = selectedVanillaArmors.length * ARMOR_SLOTS.length;
    let totalMainModOps = allSelectedArmors.length * ARMOR_SLOTS.length * customMaterials.length;

if (customMaterials.length > 0) {
    totalMainModOps += allSelectedArmors.length * ARMOR_SLOTS.length * customMaterials.length;
}
const selectedCustomArmors = allSelectedArmors.filter(armor => !vanillaArmors.includes(armor));
if (selectedCustomArmors.length > 0 && customArmors.length > 0) {
    totalMainModOps += selectedCustomArmors.length * ARMOR_SLOTS.length * VANILLA_MATERIALS.length;
}

    let totalVanillaCustomSlotOps = 0;
    vanillaArmors.forEach(armorType => {
        if (customArmorSlots[armorType] && customArmorSlots[armorType].customSlots) {
            totalVanillaCustomSlotOps += customArmorSlots[armorType].customSlots.length * customMaterials.length;
        }
    });

    const totalAdditionalOps = additionalMods.reduce((sum, mod) => {
        if (!mod.modId || !mod.armorTypes || mod.armorTypes.length === 0) return sum;

        let modOps = mod.armorTypes.length * ARMOR_SLOTS.length;

        if (mod.customMaterials && mod.customMaterials.length > 0) {
            modOps += mod.armorTypes.length * ARMOR_SLOTS.length * mod.customMaterials.length;
        }

        return sum + modOps;
    }, 0);

    const totalOperations = totalVanillaOps + totalMainModOps + totalVanillaCustomSlotOps + totalAdditionalOps;

    let completedOperations = 0;

updateProgress(10, 'Generating vanilla armor selectors...');
await new Promise(resolve => setTimeout(resolve, 50));

selectedVanillaArmors.forEach(armorType => {
    const slotNames = getArmorSlotNames(armorType);
    slotNames.forEach(slotName => {
        const model = createSelectModel(armorType, slotName, modId, customMaterials);
        const content = JSON.stringify(model, null, 2);
        const filename = `${armorType}_${slotName}.json`;
        selectFolder.file(filename, content);
        generatedFiles[`VanillaItems/${filename}`] = {
            category: 'VanillaItems',
            name: filename,
            content: content
        };
        completedOperations++;
    });
});

const vanillaProgress = 20 + (completedOperations / totalOperations) * 60;
updateProgress(vanillaProgress, `Generated ${completedOperations}/${totalOperations} files...`);
await new Promise(resolve => setTimeout(resolve, 50));

updateProgress(vanillaProgress + 5, 'Generating custom trim models...');
await new Promise(resolve => setTimeout(resolve, 50));
if (customMaterials.length > 0) {
    allSelectedArmors.forEach(armorType => {
        const slotNames = getArmorSlotNames(armorType);
        slotNames.forEach((slotName) => {
            customMaterials.forEach(material => {
                const model = createTrimModel(armorType, slotName, material);
                const content = JSON.stringify(model, null, 2);
                const filename = `${armorType}_${slotName}_${material}_trim.json`;
                mainModFolder.file(filename, content);
                generatedFiles[`${modId}-CustomLayeredItem/${filename}`] = {
                    category: `${modId}-CustomLayeredItem`,
                    name: filename,
                    content: content
                };
                completedOperations++;
            });
        });
    });
}

if (customArmors.length > 0) {
    const vanillaArmors = ['leather', 'chainmail', 'iron', 'golden', 'diamond', 'netherite', 'copper'];
    const selectedCustomArmors = allSelectedArmors.filter(armor => !vanillaArmors.includes(armor));

    if (selectedCustomArmors.length > 0) {
        const vanillaTrimsFolder = zip.folder(`${modId}-VanillaTrims`);

        selectedCustomArmors.forEach(armorType => {
            const slotNames = getArmorSlotNames(armorType);
            slotNames.forEach((slotName) => {
                VANILLA_MATERIALS.forEach(([ns, mat]) => {
                    const model = createTrimModel(armorType, slotName, mat);
                    const content = JSON.stringify(model, null, 2);
                    const filename = `${armorType}_${slotName}_${mat}_trim.json`;
                    vanillaTrimsFolder.file(filename, content);
                    generatedFiles[`${modId}-VanillaTrims/${filename}`] = {
                        category: `${modId}-VanillaTrims`,
                        name: filename,
                        content: content
                    };
                    completedOperations++;
                });
            });
        });
    }
}

    const mainModProgress = 20 + (completedOperations / totalOperations) * 60;
    updateProgress(mainModProgress, `Generated ${completedOperations}/${totalOperations} files...`);
    await new Promise(resolve => setTimeout(resolve, 50));

updateProgress(mainModProgress + 2, 'Checking for vanilla armor custom slots...');
await new Promise(resolve => setTimeout(resolve, 50));

const vanillaWithCustomSlots = vanillaArmors.filter(armorType => {
    return customArmorSlots[armorType] &&
           customArmorSlots[armorType].customSlots &&
           customArmorSlots[armorType].customSlots.length > 0;
});

if (vanillaWithCustomSlots.length > 0) {
    updateProgress(mainModProgress + 3, 'Generating vanilla armor custom slots...');
    await new Promise(resolve => setTimeout(resolve, 50));

    const slotsByModId = {};
    vanillaWithCustomSlots.forEach(armorType => {
        customArmorSlots[armorType].customSlots.forEach(slot => {
            if (!slot.name) return;

            const targetModId = slot.modId || modId;
            if (!slotsByModId[targetModId]) {
                slotsByModId[targetModId] = { trimModels: [], selectorModels: [] };
            }
            slotsByModId[targetModId].trimModels.push({ armorType, slot });
            slotsByModId[targetModId].selectorModels.push({ armorType, slot });
        });
    });

    Object.entries(slotsByModId).forEach(([targetModId, data]) => {
        const vanillaCustomFolder = zip.folder(`${targetModId}-VanillaCustomSlots`);

        data.trimModels.forEach(({ armorType, slot }) => {
            customMaterials.forEach(material => {
                const model = createTrimModel(armorType, slot.name, material);
                const content = JSON.stringify(model, null, 2);
                const filename = `${armorType}_${slot.name}_${material}_trim.json`;
                vanillaCustomFolder.file(filename, content);
                generatedFiles[`${targetModId}-VanillaCustomSlots/${filename}`] = {
                    category: `${targetModId}-VanillaCustomSlots`,
                    name: filename,
                    content: content
                };
                completedOperations++;
            });
        });

        const vanillaCustomItemsFolder = zip.folder(`${targetModId}-VanillaCustomSlots-Items`);

        data.selectorModels.forEach(({ armorType, slot }) => {
            const model = createCustomSlotSelectModel(armorType, slot.name, modId, customMaterials, targetModId);
            const content = JSON.stringify(model, null, 2);
            const filename = `${armorType}_${slot.name}.json`;
            vanillaCustomItemsFolder.file(filename, content);
            generatedFiles[`${targetModId}-VanillaCustomSlots-Items/${filename}`] = {
                category: `${targetModId}-VanillaCustomSlots-Items`,
                name: filename,
                content: content
            };
        });
    });
}

    const vanillaCustomProgress = 20 + (completedOperations / totalOperations) * 60;
    updateProgress(vanillaCustomProgress, `Generated ${completedOperations}/${totalOperations} files...`);
    await new Promise(resolve => setTimeout(resolve, 50));

    if (additionalMods.length > 0) {
        updateProgress(vanillaCustomProgress + 5, 'Generating additional mod models...');
        await new Promise(resolve => setTimeout(resolve, 50));

        additionalMods.forEach(mod => {
            if (!mod.modId || !mod.armorTypes || mod.armorTypes.length === 0) return;

            const modItemsFolder = zip.folder(`${mod.modId}-ItemModels`);

            mod.armorTypes.forEach(armorType => {
                const slotNames = getArmorSlotNames(armorType);
                slotNames.forEach(slotName => {
                    const model = createSelectModel(armorType, slotName, modId, customMaterials);
                    const content = JSON.stringify(model, null, 2);
                    const filename = `${armorType}_${slotName}.json`;
                    modItemsFolder.file(filename, content);
                    generatedFiles[`${mod.modId}-ItemModels/${filename}`] = {
                        category: `${mod.modId}-ItemModels`,
                        name: filename,
                        content: content
                    };
                    completedOperations++;
                });
            });

            if (mod.customMaterials && mod.customMaterials.length > 0) {
                const modTrimFolder = zip.folder(`${mod.modId}-CustomLayeredItem`);

                mod.armorTypes.forEach(armorType => {
                    const slotNames = getArmorSlotNames(armorType);
                    slotNames.forEach(slotName => {
                        mod.customMaterials.forEach(material => {
                            const model = createTrimModel(armorType, slotName, material);
                            const content = JSON.stringify(model, null, 2);
                            const filename = `${armorType}_${slotName}_${material}_trim.json`;
                            modTrimFolder.file(filename, content);
                            generatedFiles[`${mod.modId}-CustomLayeredItem/${filename}`] = {
                                category: `${mod.modId}-CustomLayeredItem`,
                                name: filename,
                                content: content
                            };
                            completedOperations++;
                        });
                    });
                });
            }
        });
    }

    if (generateAtlases) {
        updateProgress(88, 'Generating atlas files...');
        await new Promise(resolve => setTimeout(resolve, 50));

        const atlasFolder = zip.folder('Atlases');

        const blocksAtlas = createBlocksAtlas(modId);
        atlasFolder.file('blocks.json', JSON.stringify(blocksAtlas, null, 2));
        generatedFiles['Atlases/blocks.json'] = {
            category: 'Atlases',
            name: 'blocks.json',
            content: JSON.stringify(blocksAtlas, null, 2)
        };

        const armorTrimsAtlas = createArmorTrimsAtlas(modId);
        atlasFolder.file('armor_trims.json', JSON.stringify(armorTrimsAtlas, null, 2));
        generatedFiles['Atlases/armor_trims.json'] = {
            category: 'Atlases',
            name: 'armor_trims.json',
            content: JSON.stringify(armorTrimsAtlas, null, 2)
        };
    }

    updateProgress(90, 'Creating ZIP file...');
    await new Promise(resolve => setTimeout(resolve, 100));

    generatedZip = await zip.generateAsync({ type: 'blob' });
    const sizeKB = (generatedZip.size / 1024).toFixed(2);

    updateProgress(95, 'Finalizing...');
    await new Promise(resolve => setTimeout(resolve, 100));

    document.getElementById('fileSize').textContent = `${sizeKB} KB`;

let directoryHTML = '';

const hasCustomArmorWithVanillaTrims = allSelectedArmors.some(armor => !vanillaArmors.includes(armor));

if (hasCustomArmorWithVanillaTrims && customArmors.length > 0) {
    directoryHTML += `
        <strong>${modId}-VanillaTrims/</strong><br>
        <em>Purpose: Vanilla trim material models for your custom armor types (${customArmors.join(', ')})</em><br>
        Extract to: <code>resources/assets/${modId}/models/item/</code><br><br>
    `;
}

if (selectedVanillaArmors.length > 0) {
    directoryHTML += `
        <strong>VanillaItems/</strong><br>
        ...
    `;
}

    directoryHTML += `
        <strong>${modId}-CustomLayeredItem/</strong><br>
        <em>Purpose: Your custom trim material models for all selected armor types</em><br>
        Extract to: <code>resources/assets/${modId}/models/item/</code><br><br>
    `;

if (vanillaWithCustomSlots.length > 0) {
    const groupedByMod = {};
    vanillaWithCustomSlots.forEach(armor => {
        customArmorSlots[armor].customSlots.forEach(slot => {
            const targetModId = slot.modId || modId;
            if (!groupedByMod[targetModId]) {
                groupedByMod[targetModId] = { armors: [], slots: [] };
            }
            if (!groupedByMod[targetModId].armors.includes(armor)) {
                groupedByMod[targetModId].armors.push(armor);
            }
            if (slot.name && !groupedByMod[targetModId].slots.includes(slot.name)) {
                groupedByMod[targetModId].slots.push(slot.name);
            }
        });
    });

    Object.entries(groupedByMod).forEach(([targetModId, data]) => {
        directoryHTML += `
            <strong>${targetModId}-VanillaCustomSlots/</strong><br>
            <em>Purpose: Custom slot trim models for vanilla armors (${data.armors.join(', ')}) - Slots: ${data.slots.join(', ')}</em><br>
            Extract to: <code>resources/assets/${targetModId}/models/item/</code><br><br>

            <strong>${targetModId}-VanillaCustomSlots-Items/</strong><br>
            <em>Purpose: Selector files that enable trim support for custom slots (${data.slots.join(', ')})</em><br>
            Extract to: <code>resources/assets/${targetModId}/items/</code><br><br>
        `;
    });
}

    if (generateAtlases) {
        directoryHTML += `
            <strong>Atlases/</strong><br>
            <em>Purpose: Atlas definitions for custom trim materials</em><br>
            Extract to: <code>resources/assets/minecraft/atlases/</code><br><br>
        `;
    }

    additionalMods.forEach(mod => {
        if (!mod.modId || !mod.armorTypes || mod.armorTypes.length === 0) return;

        directoryHTML += `
            <strong>${mod.modId}-ItemModels/</strong><br>
            <em>Purpose: Replaces ${mod.modId}'s armor item models to support your trim materials</em><br>
            Extract to: <code>resources/assets/${mod.modId}/items/</code><br><br>
        `;

        if (mod.customMaterials && mod.customMaterials.length > 0) {
            directoryHTML += `
                <strong>${mod.modId}-CustomLayeredItem/</strong><br>
                <em>Purpose: ${mod.modId}'s custom trim material models for their armor types</em><br>
                Extract to: <code>resources/assets/${mod.modId}/models/item/</code><br><br>
            `;
        }
    });

    document.getElementById('directoryInfo').innerHTML = directoryHTML;

    renderPreviewFiles();
    updateSummaryStats();
    document.getElementById('downloadSection').classList.add('show');

    updateProgress(100, 'Complete!');
    await new Promise(resolve => setTimeout(resolve, 300));

    hideProgress();

    const folderCount = new Set(Object.values(generatedFiles).map(f => f.category)).size;
    showToast(`Generated ${Object.keys(generatedFiles).length} files across ${folderCount} folders`, 'success');
}

function getArmorSlotNames(armorType) {
    if (customArmorSlots[armorType] && customArmorSlots[armorType].customSlots) {
        return [...ARMOR_SLOTS, ...customArmorSlots[armorType].customSlots.map(s => s.name)];
    }
    return [...ARMOR_SLOTS];
}

function getArmorSlotTexture(armorType, slotName) {
    if (customArmorSlots[armorType] && customArmorSlots[armorType].textureOverrides) {
        const override = customArmorSlots[armorType].textureOverrides[slotName];
        if (override) {
            return override;
        }
    }
    return slotName;
}

function showArmorSlotCustomizationModal() {
    const allArmors = [
        ...getSelectedArmorTypes(),
        ...Array.from(document.querySelectorAll('#modArmorTypesSection input[type="checkbox"]:checked')).map(cb => cb.value)
    ];

    const vanillaArmors = ['leather', 'chainmail', 'iron', 'golden', 'diamond', 'netherite', 'copper'];

    const mainModId = document.getElementById('modId').value.trim();
    const availableModIds = [mainModId, ...additionalMods.map(m => m.modId).filter(id => id)];

    const modalOverlay = document.createElement('div');
    modalOverlay.className = 'modal-overlay show';
    modalOverlay.style.zIndex = '3000';

    let armorInputsHTML = allArmors.map(armor => {
        const isVanilla = vanillaArmors.includes(armor);
        const config = customArmorSlots[armor] || { textureOverrides: {}, customSlots: [], modId: mainModId };

        return `
            <div style="margin-bottom: 25px; padding: 20px; background: #3a3a3a; border: 2px solid #1a1a1a;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="color: #3453df; margin: 0; font-family: 'Minecraft Ten', 'Inter', sans-serif;">
                        ${armor.charAt(0).toUpperCase() + armor.slice(1)}
                        ${isVanilla ? '<span style="font-size: 11px; color: #a0a0a0; font-family: Nunito, sans-serif; margin-left: 8px;">(Vanilla)</span>' : ''}
                    </h4>
                    <button class="minecraft-button small" onclick="event.stopPropagation(); addCustomSlot('${armor}')">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">+ Add Custom Slot</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                </div>

                <h5 style="color: #3453df; font-size: 13px; margin-bottom: 10px; font-family: 'Minecraft Ten', 'Inter', sans-serif;">
                    Texture Overrides (Basic Slots)
                </h5>
                <div style="display: grid; gap: 10px; margin-bottom: 15px;">
                    ${ARMOR_SLOTS.map(slot => `
                        <div style="background: #2a2a2a; padding: 10px; border: 1px solid #1a1a1a;">
                            <div style="display: grid; grid-template-columns: 100px 1fr; gap: 10px; align-items: center;">
                                <label style="font-size: 12px; color: #a0a0a0; margin: 0;">${slot.charAt(0).toUpperCase() + slot.slice(1)}:</label>
                                <input type="text"
                                       value="${config.textureOverrides[slot] || ''}"
                                       data-armor="${armor}"
                                       data-slot="${slot}"
                                       class="slot-texture-override"
                                       placeholder="${armor}_${slot}"
                                       oninput="this.value = this.value.toLowerCase()"
                                       style="width: 100%; padding: 6px; background: #1a1a1a; border: 2px solid #0a0a0a; color: #e6e6e6; font-size: 12px;">
                            </div>
                        </div>
                    `).join('')}
                </div>

                ${config.customSlots.length > 0 ? `
    <h5 style="color: #3453df; font-size: 13px; margin-bottom: 10px; font-family: 'Minecraft Ten', 'Inter', sans-serif;">
        Custom Slots
    </h5>
    <div style="display: grid; gap: 10px;">
        ${config.customSlots.map((slot, idx) => `
            <div style="background: #2a2a2a; padding: 10px; border: 1px solid #1a1a1a;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <label style="font-size: 12px; color: #3453df; font-weight: 600; margin: 0;">Custom Slot ${idx + 1}</label>
                    <button onclick="event.stopPropagation(); removeCustomSlot('${armor}', ${idx})"
                            style="background: none; border: none; color: #ff6b6b; cursor: pointer; font-size: 18px; padding: 0; width: 20px; height: 20px;">×</button>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <div>
                        <label style="font-size: 11px; color: #a0a0a0; margin-bottom: 4px; display: block;">Slot Name:</label>
                        <input type="text"
                               value="${slot.name}"
                               data-armor="${armor}"
                               data-custom-slot="${idx}"
                               class="custom-slot-name"
                               placeholder="e.g., gauntlets"
                               oninput="this.value = this.value.toLowerCase()"
                               style="width: 100%; padding: 6px; background: #1a1a1a; border: 2px solid #0a0a0a; color: #e6e6e6; font-size: 12px;">
                    </div>
                    <div>
                        <label style="font-size: 11px; color: #a0a0a0; margin-bottom: 4px; display: block;">Texture Override:</label>
                        <input type="text"
                               value="${slot.texture || ''}"
                               data-armor="${armor}"
                               data-custom-slot="${idx}"
                               class="custom-slot-texture"
                               placeholder="${armor}_${slot.name || 'slotname'}"
                               oninput="this.value = this.value.toLowerCase()"
                               style="width: 100%; padding: 6px; background: #1a1a1a; border: 2px solid #0a0a0a; color: #e6e6e6; font-size: 12px;">
                    </div>
                </div>
                <div>
                    <label style="font-size: 11px; color: #a0a0a0; margin-bottom: 4px; display: block;">Mod ID for this slot:</label>
                    <select data-armor="${armor}" data-custom-slot="${idx}" class="custom-slot-mod-id"
                            style="width: 100%; padding: 6px; background: #1a1a1a; border: 2px solid #0a0a0a; color: #e6e6e6; font-size: 12px; cursor: pointer;">
                        ${availableModIds.map(modId => `
                            <option value="${modId}" ${(slot.modId || mainModId) === modId ? 'selected' : ''}>${modId}</option>
                        `).join('')}
                    </select>
                    <p style="font-size: 10px; color: #888; margin-top: 4px; line-height: 1.3;">
                        Trim models for this slot will be generated in this mod's namespace
                    </p>
                </div>
            </div>
        `).join('')}
    </div>
` : ''}
            </div>
        `;
    }).join('');

    modalOverlay.innerHTML = `
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 800px; max-height: 85vh;">
            <div class="modal-header">
                <div class="modal-title">Customize Armor Slots</div>
                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">
                    <img src="assets/buttons/exit.png" alt="Close">
                </button>
            </div>
            <div class="modal-body" style="overflow-y: auto;">
                <div style="margin: 0 0 20px 0; padding: 15px; background: #2a2a2a; border-left: 3px solid #3453df;">
                    <p style="margin: 0 0 10px 0; color: #e6e6e6; font-size: 14px; line-height: 1.6;">
                        <strong>Texture Override:</strong> Changes the texture path if the mod uses different naming (e.g., <code>steel_hat</code> instead of <code>steel_helmet</code>)
                    </p>
                    <p style="margin: 0 0 10px 0; color: #e6e6e6; font-size: 14px; line-height: 1.6;">
                        <strong>Custom Slots:</strong> Add additional slots beyond the basic 4 (e.g., <code>gauntlets</code>, <code>cape</code>)
                    </p>
                    <p style="margin: 0; color: #e6e6e6; font-size: 14px; line-height: 1.6;">
                        <strong>Vanilla Armor:</strong> When adding custom slots to vanilla armor, specify which mod namespace "owns" the gear/armor piece
                    </p>
                </div>
                <div style="max-height: 50vh; overflow-y: auto;">
                    ${armorInputsHTML}
                </div>
            </div>
            <div class="modal-footer" style="gap: 10px; justify-content: center;">
                <button class="minecraft-button" onclick="resetSlotNamesToDefault(this)">
                    <div class="minecraft-button-left-outline"></div>
                    <div class="minecraft-button-right-outline"></div>
                    <div class="minecraft-button-section">
                        <div class="minecraft-button-name">Reset All to Defaults</div>
                    </div>
                    <div class="minecraft-button-dark-strip"></div>
                    <div class="minecraft-button-bottom-outline"></div>
                    <div class="minecraft-button-shadow"></div>
                </button>
                <button class="minecraft-button success" onclick="saveCustomSlotConfiguration(this)">
                    <div class="minecraft-button-left-outline"></div>
                    <div class="minecraft-button-right-outline"></div>
                    <div class="minecraft-button-section">
                        <div class="minecraft-button-name">Save Changes</div>
                    </div>
                    <div class="minecraft-button-dark-strip"></div>
                    <div class="minecraft-button-bottom-outline"></div>
                    <div class="minecraft-button-shadow"></div>
                </button>
            </div>
        </div>
    `;

    document.body.appendChild(modalOverlay);
    attachButtonAnimations();
}

function addCustomSlot(armor) {
    if (!customArmorSlots[armor]) {
        customArmorSlots[armor] = { textureOverrides: {}, customSlots: [] };
    }

    const mainModId = document.getElementById('modId').value.trim();
    customArmorSlots[armor].customSlots.push({ name: '', texture: '', modId: mainModId });

    const modalBody = document.querySelector('.modal-overlay .modal-body');
    const scrollPosition = modalBody ? modalBody.scrollTop : 0;

    updateModalContent();

    setTimeout(() => {
        const newModalBody = document.querySelector('.modal-overlay .modal-body');
        if (newModalBody) {
            newModalBody.scrollTop = scrollPosition;
        }
    }, 0);

    showToast('Custom slot added', 'info');
}

function resetSlotNamesToDefault(button) {
    customArmorSlots = {};

    updateModalContent();

    showToast('Reset to defaults', 'info');
}

function updateModalContent() {
    const allArmors = [
        ...getSelectedArmorTypes(),
        ...Array.from(document.querySelectorAll('#modArmorTypesSection input[type="checkbox"]:checked')).map(cb => cb.value)
    ];

    const vanillaArmors = ['leather', 'chainmail', 'iron', 'golden', 'diamond', 'netherite', 'copper'];

    const mainModId = document.getElementById('modId').value.trim();
    const availableModIds = [mainModId, ...additionalMods.map(m => m.modId).filter(id => id)];

    let armorInputsHTML = allArmors.map(armor => {
        const isVanilla = vanillaArmors.includes(armor);
        const config = customArmorSlots[armor] || { textureOverrides: {}, customSlots: [], modId: mainModId };

        return `
            <div style="margin-bottom: 25px; padding: 20px; background: #3a3a3a; border: 2px solid #1a1a1a;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="color: #3453df; margin: 0; font-family: 'Minecraft Ten', 'Inter', sans-serif;">
                        ${armor.charAt(0).toUpperCase() + armor.slice(1)}
                        ${isVanilla ? '<span style="font-size: 11px; color: #a0a0a0; font-family: Nunito, sans-serif; margin-left: 8px;">(Vanilla)</span>' : ''}
                    </h4>
                    <button class="minecraft-button small" onclick="event.stopPropagation(); addCustomSlot('${armor}')">
                        <div class="minecraft-button-left-outline"></div>
                        <div class="minecraft-button-right-outline"></div>
                        <div class="minecraft-button-section">
                            <div class="minecraft-button-name">+ Add Custom Slot</div>
                        </div>
                        <div class="minecraft-button-dark-strip"></div>
                        <div class="minecraft-button-bottom-outline"></div>
                        <div class="minecraft-button-shadow"></div>
                    </button>
                </div>

                <h5 style="color: #3453df; font-size: 13px; margin-bottom: 10px; font-family: 'Minecraft Ten', 'Inter', sans-serif;">
                    Texture Overrides (Basic Slots)
                </h5>
                <div style="display: grid; gap: 10px; margin-bottom: 15px;">
                    ${ARMOR_SLOTS.map(slot => `
                        <div style="background: #2a2a2a; padding: 10px; border: 1px solid #1a1a1a;">
                            <div style="display: grid; grid-template-columns: 100px 1fr; gap: 10px; align-items: center;">
                                <label style="font-size: 12px; color: #a0a0a0; margin: 0;">${slot.charAt(0).toUpperCase() + slot.slice(1)}:</label>
                                <input type="text"
                                       value="${config.textureOverrides[slot] || ''}"
                                       data-armor="${armor}"
                                       data-slot="${slot}"
                                       class="slot-texture-override"
                                       placeholder="${armor}_${slot}"
                                       oninput="this.value = this.value.toLowerCase()"
                                       style="width: 100%; padding: 6px; background: #1a1a1a; border: 2px solid #0a0a0a; color: #e6e6e6; font-size: 12px;">
                            </div>
                        </div>
                    `).join('')}
                </div>

                ${config.customSlots.length > 0 ? `
    <h5 style="color: #3453df; font-size: 13px; margin-bottom: 10px; font-family: 'Minecraft Ten', 'Inter', sans-serif;">
        Custom Slots
    </h5>
    <div style="display: grid; gap: 10px;">
        ${config.customSlots.map((slot, idx) => `
            <div style="background: #2a2a2a; padding: 10px; border: 1px solid #1a1a1a;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <label style="font-size: 12px; color: #3453df; font-weight: 600; margin: 0;">Custom Slot ${idx + 1}</label>
                    <button onclick="event.stopPropagation(); removeCustomSlot('${armor}', ${idx})"
                            style="background: none; border: none; color: #ff6b6b; cursor: pointer; font-size: 18px; padding: 0; width: 20px; height: 20px;">×</button>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <div>
                        <label style="font-size: 11px; color: #a0a0a0; margin-bottom: 4px; display: block;">Slot Name:</label>
                        <input type="text"
                               value="${slot.name}"
                               data-armor="${armor}"
                               data-custom-slot="${idx}"
                               class="custom-slot-name"
                               placeholder="e.g., gauntlets"
                               oninput="this.value = this.value.toLowerCase()"
                               style="width: 100%; padding: 6px; background: #1a1a1a; border: 2px solid #0a0a0a; color: #e6e6e6; font-size: 12px;">
                    </div>
                    <div>
                        <label style="font-size: 11px; color: #a0a0a0; margin-bottom: 4px; display: block;">Texture Override:</label>
                        <input type="text"
                               value="${slot.texture || ''}"
                               data-armor="${armor}"
                               data-custom-slot="${idx}"
                               class="custom-slot-texture"
                               placeholder="${armor}_${slot.name || 'slotname'}"
                               oninput="this.value = this.value.toLowerCase()"
                               style="width: 100%; padding: 6px; background: #1a1a1a; border: 2px solid #0a0a0a; color: #e6e6e6; font-size: 12px;">
                    </div>
                </div>
                <div>
                    <label style="font-size: 11px; color: #a0a0a0; margin-bottom: 4px; display: block;">Mod ID for this slot:</label>
                    <select data-armor="${armor}" data-custom-slot="${idx}" class="custom-slot-mod-id"
                            style="width: 100%; padding: 6px; background: #1a1a1a; border: 2px solid #0a0a0a; color: #e6e6e6; font-size: 12px; cursor: pointer;">
                        ${availableModIds.map(modId => `
                            <option value="${modId}" ${(slot.modId || mainModId) === modId ? 'selected' : ''}>${modId}</option>
                        `).join('')}
                    </select>
                    <p style="font-size: 10px; color: #888; margin-top: 4px; line-height: 1.3;">
                        Trim models for this slot will be generated in this mod's namespace
                    </p>
                </div>
            </div>
        `).join('')}
    </div>
` : ''}
            </div>
        `;
    }).join('');

    const contentArea = document.querySelector('.modal-overlay .modal-body > div:last-child');
    if (contentArea) {
        contentArea.innerHTML = armorInputsHTML;
        attachButtonAnimations();
    }
}

function createCustomSlotSelectModel(armorType, slotName, modId, materials, ownerModId) {
    const model = {
        type: "minecraft:select",
        cases: [],
        fallback: {
            type: "minecraft:model",
            model: `${ownerModId}:item/${armorType}_${slotName}`
        },
        property: "minecraft:trim_material"
    };

    if (armorType === 'leather') {
        model.fallback.tints = [{ type: "minecraft:dye", default: -6265536 }];
    }

    VANILLA_MATERIALS.forEach(([ns, mat]) => {
        const caseObj = {
            model: {
                type: "minecraft:model",
                model: `${ownerModId}:item/${armorType}_${slotName}_${mat}_trim`
            },
            when: `${ns}:${mat}`
        };
        if (armorType === 'leather') {
            caseObj.model.tints = [{ type: "minecraft:dye", default: -6265536 }];
        }
        model.cases.push(caseObj);
    });

    materials.forEach(mat => {
        const caseObj = {
            model: {
                type: "minecraft:model",
                model: `${ownerModId}:item/${armorType}_${slotName}_${mat}_trim`
            },
            when: `${modId}:${mat}`
        };
        if (armorType === 'leather') {
            caseObj.model.tints = [{ type: "minecraft:dye", default: -6265536 }];
        }
        model.cases.push(caseObj);
    });

    return { model };
}

function saveCustomSlotConfiguration(button) {
    const textureOverrides = document.querySelectorAll('.slot-texture-override');
    const customSlotNames = document.querySelectorAll('.custom-slot-name');
    const customSlotTextures = document.querySelectorAll('.custom-slot-texture');
    const modIdSelects = document.querySelectorAll('.armor-mod-id-select');
    const tempConfig = {};

    textureOverrides.forEach(input => {
        const armor = input.dataset.armor;
        const slot = input.dataset.slot;
        const value = input.value.trim().toLowerCase();

        if (!tempConfig[armor]) {
            tempConfig[armor] = { textureOverrides: {}, customSlots: [] };
        }

        if (value) {
            tempConfig[armor].textureOverrides[slot] = value;
        }
    });

    const customSlotModIds = document.querySelectorAll('.custom-slot-mod-id');
customSlotNames.forEach((nameInput, i) => {
    const textureInput = customSlotTextures[i];
    const modIdSelect = customSlotModIds[i];
    const armor = nameInput.dataset.armor;
    const slotIndex = parseInt(nameInput.dataset.customSlot);
    const slotName = nameInput.value.trim().toLowerCase();
    const slotTexture = textureInput.value.trim().toLowerCase();
    const slotModId = modIdSelect ? modIdSelect.value : document.getElementById('modId').value.trim();

    if (!tempConfig[armor]) {
        tempConfig[armor] = { textureOverrides: {}, customSlots: [] };
    }

    if (slotName) {
        if (!tempConfig[armor].customSlots) {
            tempConfig[armor].customSlots = [];
        }
        tempConfig[armor].customSlots[slotIndex] = {
            name: slotName,
            texture: slotTexture || null,
            modId: slotModId
        };
    }
});

    customArmorSlots = tempConfig;
    button.closest('.modal-overlay').remove();
    showToast('Slot configuration saved!', 'success');
}

function removeCustomSlot(armor, slotIndex) {
    if (!customArmorSlots[armor] || !customArmorSlots[armor].customSlots) return;

    const modalBody = document.querySelector('.modal-overlay .modal-body');
    const scrollPosition = modalBody ? modalBody.scrollTop : 0;

    customArmorSlots[armor].customSlots.splice(slotIndex, 1);

    if (customArmorSlots[armor].customSlots.length === 0) {
        if (Object.keys(customArmorSlots[armor].textureOverrides || {}).length === 0) {
            delete customArmorSlots[armor];
        } else {
            delete customArmorSlots[armor].customSlots;
        }
    }

    updateModalContent();

    setTimeout(() => {
        const newModalBody = document.querySelector('.modal-overlay .modal-body');
        if (newModalBody) {
            newModalBody.scrollTop = scrollPosition;
        }
        attachButtonAnimations();
    }, 10);

    showToast('Custom slot removed', 'info');
}

function saveCustomSlotNames(button) {
    const nameInputs = document.querySelectorAll('.slot-name-input');
    const textureInputs = document.querySelectorAll('.slot-texture-input');
    const tempSlots = {};

    nameInputs.forEach((nameInput, i) => {
        const textureInput = textureInputs[i];
        const armor = nameInput.dataset.armor;
        const slotIndex = parseInt(nameInput.dataset.slot);
        const slotName = nameInput.value.trim().toLowerCase();
        const slotTexture = textureInput.value.trim().toLowerCase();

        if (!tempSlots[armor]) {
            tempSlots[armor] = [];
        }

        tempSlots[armor][slotIndex] = {
            name: slotName || ARMOR_SLOTS[Math.min(slotIndex, 3)],
            texture: slotTexture || `${slotName || ARMOR_SLOTS[Math.min(slotIndex, 3)]}_trim`
        };
    });

    customArmorSlots = tempSlots;
    button.closest('.modal-overlay').remove();
    showToast('Slot configuration saved!', 'success');
}

function resetSlotNamesToDefault(button) {
    customArmorSlots = {};

    const modalBody = document.querySelector('.modal-overlay .modal-body');
    const scrollPosition = modalBody ? modalBody.scrollTop : 0;

    updateModalContent();

    setTimeout(() => {
        const newModalBody = document.querySelector('.modal-overlay .modal-body');
        if (newModalBody) {
            newModalBody.scrollTop = scrollPosition;
        }
    }, 0);

    showToast('Reset to defaults', 'info');
}

function createBlocksAtlas(modId) {
    const atlas = {
        replace: false,
        sources: [
            {
                type: "minecraft:directory",
                prefix: "block/",
                source: "block"
            },
            {
                type: "minecraft:directory",
                prefix: "item/",
                source: "item"
            },
            {
                type: "minecraft:directory",
                prefix: "entity/conduit/",
                source: "entity/conduit"
            },
            {
                type: "minecraft:single",
                resource: "minecraft:entity/bell/bell_body"
            },
            {
                type: "minecraft:single",
                resource: "minecraft:entity/decorated_pot/decorated_pot_side"
            },
            {
                type: "minecraft:single",
                resource: "minecraft:entity/enchanting_table_book"
            },
            {
                type: "minecraft:paletted_permutations",
                palette_key: "trims/color_palettes/trim_palette",
                permutations: {
                    amethyst: "minecraft:trims/color_palettes/amethyst",
                    copper: "minecraft:trims/color_palettes/copper",
                    copper_darker: "minecraft:trims/color_palettes/copper_darker",
                    diamond: "minecraft:trims/color_palettes/diamond",
                    diamond_darker: "minecraft:trims/color_palettes/diamond_darker",
                    emerald: "minecraft:trims/color_palettes/emerald",
                    gold: "minecraft:trims/color_palettes/gold",
                    gold_darker: "minecraft:trims/color_palettes/gold_darker",
                    iron: "minecraft:trims/color_palettes/iron",
                    iron_darker: "minecraft:trims/color_palettes/iron_darker",
                    lapis: "minecraft:trims/color_palettes/lapis",
                    netherite: "minecraft:trims/color_palettes/netherite",
                    netherite_darker: "minecraft:trims/color_palettes/netherite_darker",
                    quartz: "minecraft:trims/color_palettes/quartz",
                    redstone: "minecraft:trims/color_palettes/redstone",
                    resin: "minecraft:trims/color_palettes/resin"
                },
                textures: [
                    "minecraft:trims/items/helmet_trim",
                    "minecraft:trims/items/chestplate_trim",
                    "minecraft:trims/items/leggings_trim",
                    "minecraft:trims/items/boots_trim"
                ]
            }
        ]
    };

    customMaterials.forEach(material => {
        atlas.sources[6].permutations[material] = `${modId}:trims/color_palettes/${material}`;
    });

    return atlas;
}

function createArmorTrimsAtlas(modId) {
    const atlas = {
        replace: false,
        sources: [
            {
                type: "minecraft:paletted_permutations",
                textures: [
                    "trims/entity/humanoid/coast",
                    "trims/entity/humanoid_leggings/coast",
                    "trims/entity/humanoid/sentry",
                    "trims/entity/humanoid_leggings/sentry",
                    "trims/entity/humanoid/dune",
                    "trims/entity/humanoid_leggings/dune",
                    "trims/entity/humanoid/wild",
                    "trims/entity/humanoid_leggings/wild",
                    "trims/entity/humanoid/ward",
                    "trims/entity/humanoid_leggings/ward",
                    "trims/entity/humanoid/eye",
                    "trims/entity/humanoid_leggings/eye",
                    "trims/entity/humanoid/vex",
                    "trims/entity/humanoid_leggings/vex",
                    "trims/entity/humanoid/tide",
                    "trims/entity/humanoid_leggings/tide",
                    "trims/entity/humanoid/snout",
                    "trims/entity/humanoid_leggings/snout",
                    "trims/entity/humanoid/rib",
                    "trims/entity/humanoid_leggings/rib",
                    "trims/entity/humanoid/spire",
                    "trims/entity/humanoid_leggings/spire",
                    "trims/entity/humanoid/wayfinder",
                    "trims/entity/humanoid_leggings/wayfinder",
                    "trims/entity/humanoid/shaper",
                    "trims/entity/humanoid_leggings/shaper",
                    "trims/entity/humanoid/silence",
                    "trims/entity/humanoid_leggings/silence",
                    "trims/entity/humanoid/raiser",
                    "trims/entity/humanoid_leggings/raiser",
                    "trims/entity/humanoid/host",
                    "trims/entity/humanoid_leggings/host",
                    "trims/entity/humanoid/flow",
                    "trims/entity/humanoid_leggings/flow",
                    "trims/entity/humanoid/bolt",
                    "trims/entity/humanoid_leggings/bolt"
                ],
                palette_key: "trims/color_palettes/trim_palette",
                permutations: {
                    quartz: "trims/color_palettes/quartz",
                    iron: "trims/color_palettes/iron",
                    gold: "trims/color_palettes/gold",
                    diamond: "trims/color_palettes/diamond",
                    netherite: "trims/color_palettes/netherite",
                    redstone: "trims/color_palettes/redstone",
                    copper: "trims/color_palettes/copper",
                    emerald: "trims/color_palettes/emerald",
                    lapis: "trims/color_palettes/lapis",
                    amethyst: "trims/color_palettes/amethyst",
                    iron_darker: "trims/color_palettes/iron_darker",
                    gold_darker: "trims/color_palettes/gold_darker",
                    diamond_darker: "trims/color_palettes/diamond_darker",
                    netherite_darker: "trims/color_palettes/netherite_darker"
                }
            }
        ]
    };

    customMaterials.forEach(material => {
        atlas.sources[0].permutations[material] = `${modId}:trims/color_palettes/${material}`;
    });

    return atlas;
}

function showHelp() {
    const helpHTML = `
    <div style="text-align: center; margin-bottom: 25px;">
        <img src="assets/titles/armor_trim_item_model_generator.png" alt="Armor Trim Item Generator" style="max-width:550px; height: auto; image-rendering: pixelated;">
    </div>

    <h3>What are Armor Trim Models?</h3>
    <p>Armor trim item models are JSON files that define how custom trim materials appear on armor items in Minecraft.
    When you create a custom trim material, you need these models to make the trim visible on armor items.
    Starting in Minecraft 1.21.2, Mojang changed the system to require <strong>56 separate JSON files per trim material</strong>
    (14 armor pieces × 4 slots each). This tool automates that tedious process for you.</p>

    <h3>How to Use This Generator:</h3>

    <p><strong>1. Main Mod Configuration:</strong></p>
    <ul>
        <li><strong>Mod ID</strong> (Required): Enter your mod's unique identifier (e.g., "my_mod")</li>
        <li><strong>Custom Materials</strong> (Required, at least one): Add the trim materials you're creating. Press Enter after typing each material name. Click × to remove.</li>
        <li><strong>Custom Armor Types</strong> (Optional): Add non-vanilla armor types if your mod has unique armor pieces</li>
        <li><strong>Undo/Redo</strong>: Use the ↶ Undo (Ctrl+Z) and ↷ Redo (Ctrl+Shift+Z or Ctrl+Y) buttons to revert changes. Supports up to 20 levels of history.</li>
    </ul>

    <p><strong>2. Select Armor Types:</strong></p>
    <ul>
        <li>Choose which <strong>vanilla armor types</strong> will support your custom trims (leather, chainmail, iron, golden, diamond, netherite, copper)</li>
        <li>If you added custom armor types, they'll appear in the <strong>Mod Armor Types</strong> section below</li>
        <li><strong>Important</strong>: You need at least one armor type selected (vanilla or mod)</li>
        <li>Use <strong>"Select All" / "Deselect All"</strong> buttons for quick bulk selection</li>
        <li>Each armor type generates models for all 4 slots: helmet, chestplate, leggings, boots</li>
    </ul>

    <p><strong>3. Additional Mods Support (Optional):</strong></p>
    <ul>
        <li>Add support for armor from <strong>other mods</strong> (e.g., adding your trims to Twilight Forest armor)</li>
        <li>Click <strong>"+ Add Mod"</strong> to create a new mod entry</li>
        <li>For each mod, you can:
            <ul>
                <li>Set the mod's ID</li>
                <li>Add custom materials specific to that mod</li>
                <li>Add custom armor types specific to that mod</li>
                <li>Select which armor types from your main mod and others to support</li>
            </ul>
        </li>
        <li><strong>Bulk actions</strong>:
            <ul>
                <li>"Select All Armors" - selects all available armor types for all mods</li>
                <li>"Deselect All Armors" - deselects all armor types for all mods</li>
                <li>"Remove All Mods" - removes all additional mod entries (with confirmation)</li>
            </ul>
        </li>
        <li>Per-mod bulk actions: Each mod has its own "Select All" and "Deselect All" buttons</li>
        <li>Remove individual mods with the "Remove" button</li>
    </ul>

    <p><strong>4. Customize Armor Slots (Advanced - Optional):</strong></p>
    <div style="padding: 12px; background: #3a3a3a; border-left: 3px solid #ff6b6b; margin: 10px 0;">
        <p style="margin: 0 0 8px 0; color: #ff6b6b; font-weight: 600;">⚠️ WARNING: This section can be confusing!</p>
        <p style="margin: 0; font-size: 13px; line-height: 1.5;">
            Only use this if you're working with mods that add custom armor slots (like gauntlets, capes, rings)
            or if armor pieces have non-standard naming. <strong>Most users should skip this section.</strong>
        </p>
    </div>
    <ul>
        <li>Click <strong>"Customize Armor Slots"</strong> to modify slot configurations</li>
        <li><strong>When to use this:</strong>
            <ul>
                <li>Another mod adds custom slots (e.g., "armor_plus" adds gauntlets)</li>
                <li>You need to generate trim support for those custom slots</li>
                <li>Armor pieces use non-standard texture names (e.g., "cap" instead of "helmet")</li>
            </ul>
        </li>
        <li><strong>Texture Overrides (Basic Slots):</strong>
            <ul>
                <li>Changes the texture path if the mod uses different naming</li>
                <li>Example: If a mod uses <code>steel_cap</code> instead of <code>steel_helmet</code>, override "helmet" → "cap"</li>
                <li>Leave blank to use default naming</li>
            </ul>
        </li>
        <li><strong>Custom Slots:</strong>
            <ul>
                <li>Add slots beyond the basic 4 (helmet, chestplate, leggings, boots)</li>
                <li><strong>Slot Name:</strong> The name of the custom slot (e.g., "gauntlets", "cape", "ring")</li>
                <li><strong>Texture Override:</strong> Custom texture path if needed (usually leave blank)</li>
                <li><strong>Mod ID for this slot:</strong> <span style="color: #3453df; font-weight: 600;">CRITICAL!</span> Set this to the mod that <em>created</em> the slot
                    <ul>
                        <li>If "armor_plus" adds gauntlets, set Mod ID to "armor_plus"</li>
                        <li>If "twilight_forest" adds a crown slot, set Mod ID to "twilight_forest"</li>
                        <li>This determines where the trim models and selector files are generated</li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><strong>Example Use Case:</strong>
            <div style="background: #2a2a2a; padding: 10px; margin: 8px 0; border-left: 2px solid #3453df;">
                <p style="margin: 0 0 5px 0; font-size: 13px;"><strong>Scenario:</strong> You have a mod "my_mod" with a "ruby" trim material.
                Another mod "armor_plus" adds steel gauntlets. You want ruby trims on those gauntlets.</p>
                <p style="margin: 5px 0 0 0; font-size: 13px;"><strong>Setup:</strong></p>
                <ul style="margin: 5px 0 0 20px; font-size: 13px;">
                    <li>For steel armor, add custom slot: "gauntlets"</li>
                    <li>Set Mod ID to: "armor_plus" (they own the gauntlets)</li>
                    <li>Generator creates files in both <code>armor_plus-VanillaCustomSlots/</code> and <code>armor_plus-VanillaCustomSlots-Items/</code></li>
                </ul>
            </div>
        </li>
        <li><strong>File Previews:</strong> After generation, open the preview dropdown to see what each file does or looks like</li>
        <li>Click "Reset All to Defaults" to restore standard configuration</li>
    </ul>

    <p><strong>5. Generate Atlas Files (Optional):</strong></p>
    <ul>
        <li>Check <strong>"Generate Atlas Files"</strong> to automatically create <code>blocks.json</code> and <code>armor_trims.json</code></li>
        <li>These atlas files register your custom trim materials with Minecraft's texture system</li>
        <li><code>blocks.json</code>: Registers trim textures for item models</li>
        <li><code>armor_trims.json</code>: Registers trim textures for armor entities</li>
        <li>Extract to: <code>resources/assets/minecraft/atlases/</code></li>
        <li><strong>Important</strong>: Keep <code>"replace": false</code> in the atlas files to avoid overwriting vanilla trims!</li>
    </ul>

    <p><strong>6. Generate & Download:</strong></p>
    <ul>
        <li>Click <strong>"Generate Models"</strong> to create all files</li>
        <li>The generator will validate your inputs and warn about duplicates</li>
        <li>A progress bar shows generation status</li>
        <li>Once complete, you'll see:
            <ul>
                <li>Total file size</li>
                <li>Summary statistics (total files, folders, armor types)</li>
                <li>Installation instructions for each folder</li>
            </ul>
        </li>
        <li>Click <strong>"Preview Generated Files"</strong> to expand the file browser</li>
        <li>Click any file to preview its contents in a modal</li>
        <li><strong>Hover over files</strong> to see detailed explanations of what each file does</li>
        <li>Use the search box to filter files by name or category</li>
        <li>Click <strong>"Download ZIP"</strong> to download all files as a single archive</li>
    </ul>

    <p><strong>7. Save/Load Configuration:</strong></p>
    <ul>
        <li><strong>"Save Configuration"</strong>: Exports your settings as a JSON file for later use</li>
        <li><strong>"Load Configuration"</strong>: Imports a previously saved configuration</li>
        <li>Saved configurations include:
            <ul>
                <li>Mod ID</li>
                <li>Custom materials and armor types</li>
                <li>Selected armor types (vanilla and mod)</li>
                <li>All additional mod entries and their settings</li>
                <li>Custom slot configurations</li>
            </ul>
        </li>
        <li>Perfect for working on multiple mods or sharing configurations with team members</li>
    </ul>

    <h3>Understanding Generated Files:</h3>

    <p><strong>VanillaItems/</strong></p>
    <ul>
        <li>Replaces vanilla armor item models to add support for your custom trim materials</li>
        <li>Contains one file per armor piece (e.g., <code>iron_helmet.json</code>)</li>
        <li>Install to: <code>resources/assets/minecraft/items/</code></li>
    </ul>

    <p><strong>YourMod-CustomLayeredItem/</strong></p>
    <ul>
        <li>Your custom trim material models for all selected armor types</li>
        <li>Contains files like <code>iron_helmet_ruby_trim.json</code></li>
        <li>Install to: <code>resources/assets/yourmod/models/item/</code></li>
    </ul>

    <p><strong>OtherMod-VanillaCustomSlots/</strong> (if custom slots configured)</p>
    <ul>
        <li>Trim models for custom slots that another mod created</li>
        <li>Example: <code>steel_gauntlets_ruby_trim.json</code></li>
        <li>Install to: <code>resources/assets/othermod/models/item/</code></li>
    </ul>

    <p><strong>OtherMod-VanillaCustomSlots-Items/</strong> (if custom slots configured)</p>
    <ul>
        <li>Selector files that enable trim support for the custom slots</li>
        <li>Example: <code>steel_gauntlets.json</code> (references all trim variations)</li>
        <li>Install to: <code>resources/assets/othermod/items/</code></li>
        <li><strong>Important:</strong> These go in the <code>items/</code> folder, not <code>models/item/</code>!</li>
    </ul>

    <p><strong>YourMod-ItemModels/</strong></p>
    <ul>
        <li>Generated when you add additional mods</li>
        <li>Replaces that mod's armor item models to support your trim materials</li>
        <li>Install to: <code>resources/assets/thatmod/items/</code></li>
    </ul>

    <p><strong>Atlases/</strong> (if enabled)</p>
    <ul>
        <li>Contains <code>blocks.json</code> and <code>armor_trims.json</code></li>
        <li>Registers your custom trim materials with the game's texture system</li>
        <li>Install to: <code>resources/assets/minecraft/atlases/</code></li>
    </ul>

    <h3>Tips & Best Practices:</h3>

    <ul>
        <li><strong>Duplicate warnings</strong>: If duplicates are found, you'll see a detailed warning but can choose to continue anyway</li>
        <li><strong>File previews</strong>: Each file in the preview shows a helpful explanation of what it does - hover to see details!</li>
        <li><strong>Custom Slots</strong>: Only use if you understand mod namespace ownership. When in doubt, ask the mod creator!</li>
        <li><strong>Keyboard shortcuts</strong>:
            <ul>
                <li>Esc - Close menus</li>
                <li>Ctrl+Z - Undo</li>
                <li>Ctrl+Shift+Z or Ctrl+Y - Redo</li>
            </ul>
        </li>
        <li><strong>Material naming</strong>: Use lowercase, simple names without special characters</li>
        <li><strong>Testing</strong>: After extracting files, test in-game to ensure trims appear correctly</li>
        <li><strong>Start simple</strong>: If you're new, start with just vanilla armor types and skip "Customize Armor Slots" entirely</li>
    </ul>

    <h3>The problem with this:</h3>

    <ul>
        <li>As mentioned before, <strong>some of these files can replace vanilla items.</strong>: This isn't a perfect solution to the problem, for other mods using the same technique will overlap each other, and this might break some mod's rendering of items on vanilla gear. When a good solution to this is found, the generator will be updated to have the best solution for item rendering.</li>
    </ul>

    <h3>Custom Slots Deep Dive:</h3>
    <div style="background: #2a2a2a; padding: 15px; margin: 10px 0; border-left: 3px solid #3453df;">
        <p style="margin: 0 0 10px 0; font-weight: 600;">Understanding Mod Ownership:</p>
        <p style="margin: 0 0 8px 0; font-size: 13px; line-height: 1.6;">
            When a mod adds a custom armor slot (like gauntlets), that mod "owns" the slot. All models related to that slot
            must go in that mod's namespace, even if the trim materials come from your mod.
        </p>
        <p style="margin: 0 0 8px 0; font-size: 13px; line-height: 1.6;">
            <strong>Example:</strong> Mod "armor_plus" adds gauntlets. Your mod "my_mod" adds ruby trims.
        </p>
        <ul style="margin: 5px 0 0 20px; font-size: 13px; line-height: 1.6;">
            <li>Set Custom Slot Mod ID to: <code>armor_plus</code> (they own gauntlets)</li>
            <li>Generator creates: <code>armor_plus-VanillaCustomSlots/steel_gauntlets_ruby_trim.json</code></li>
            <li>Generator creates: <code>armor_plus-VanillaCustomSlots-Items/steel_gauntlets.json</code></li>
            <li>Both files reference <code>my_mod:ruby</code> trim material, but live in <code>armor_plus</code> namespace</li>
        </ul>
        <p style="margin: 10px 0 0 0; font-size: 13px; line-height: 1.6;">
            <strong>The selector file</strong> (in items/) tells Minecraft: "When this gauntlet has a ruby trim, use this model."<br>
            <strong>The trim model</strong> (in models/item/) is the actual layered texture that gets displayed.
        </p>
    </div>

    <h3>Technical Details:</h3>

    <ul>
        <li>Generator creates <strong>selective model files</strong> using the <code>"minecraft:select"</code> type</li>
        <li>Each armor piece checks the trim material and loads the appropriate texture</li>
        <li>Vanilla trim materials (quartz, iron, netherite, etc.) are automatically included</li>
        <li>Leather armor models include dye tint support for coloring</li>
        <li>Files use Minecraft 1.21.2+ item model format</li>
        <li>Custom slot selector files are generated in <code>items/</code></li>
        <li>Trim models go in <code>models/item/</code> regardless of slot type</li>
    </ul>

    <h3>Need More Help?</h3>
    <p>If you encounter issues or have suggestions:</p>
    <ul>
        <li>Create an issue on <a href="https://github.com/PotatoWolfie/potatowolfie.github.io/issues" target="_blank">GitHub</a></li>
        <li>Provide details about your configuration and the issue</li>
        <li>Include any error messages or unexpected behavior</li>
        <li>If asking about custom slots, specify which mod owns the slot</li>
    </ul>

    <h3>Credits:</h3>
    <p>Tool created by <strong>PotatoWolfie</strong>.</p>
`;

    const modalOverlay = document.createElement('div');
    modalOverlay.className = 'modal-overlay show';
    modalOverlay.onclick = (e) => {
        if (e.target === modalOverlay) {
            modalOverlay.remove();
        }
    };

    modalOverlay.innerHTML = `
        <div class="help-modal" onclick="event.stopPropagation()">
            <div class="help-modal-header">
                <div class="help-modal-title">Help - Armor Trim Item Model Generator</div>
                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">
                    <img src="assets/buttons/exit.png" alt="Close">
                </button>
            </div>
            <div class="help-modal-body">
                ${helpHTML}
            </div>
        </div>
    `;

    document.body.appendChild(modalOverlay);
}

    function downloadZip() {
        if (generatedZip) {
            saveAs(generatedZip, 'armor_models_complete.zip');
            showToast('Download started!', 'success');
        }
    }

    let previewTargetRotation = 0;
    let previewCurrentRotation = 0;
    let isPreviewArrowAnimating = false;
    let isPreviewDropdownAnimating = false;

    function updatePreviewArrow() {
        if (previewCurrentRotation === previewTargetRotation || isPreviewArrowAnimating) return;

        const arrow = document.getElementById('previewArrow');
        isPreviewArrowAnimating = true;

        let nextRotation = previewCurrentRotation + 180;
        arrow.style.transform = `rotate(${nextRotation}deg)`;

        arrow.addEventListener('transitionend', function handler(e) {
            if (e.propertyName !== 'transform') return;

            arrow.removeEventListener('transitionend', handler);
            previewCurrentRotation = nextRotation;

            if (previewCurrentRotation >= 360) {
                arrow.style.transition = 'none';
                previewCurrentRotation -= 360;
                previewTargetRotation -= 360;
                arrow.style.transform = `rotate(${previewCurrentRotation}deg)`;

                void arrow.offsetWidth;
                arrow.style.transition = 'transform 0.4s ease';
            }

            isPreviewArrowAnimating = false;
            setTimeout(updatePreviewArrow, 10);
        });
    }

    function togglePreview() {
        const grid = document.getElementById('previewGrid');
        const container = document.getElementById('previewDropdown');

        if (isPreviewDropdownAnimating) return;

        isPreviewDropdownAnimating = true;

        if (grid.classList.contains('open')) {
            const fullHeight = grid.scrollHeight + 'px';
            grid.style.maxHeight = fullHeight;
            requestAnimationFrame(() => {
                grid.style.maxHeight = '0px';
            });
        } else {
            grid.classList.add('open');
            grid.style.maxHeight = '0px';
            requestAnimationFrame(() => {
                grid.style.maxHeight = grid.scrollHeight + 'px';
            });
        }

        grid.addEventListener('transitionend', function handler() {
            grid.removeEventListener('transitionend', handler);

            if (grid.style.maxHeight === '0px') {
                grid.classList.remove('open');
            }

            isPreviewDropdownAnimating = false;
        });

        container.classList.toggle('expanded');

        previewTargetRotation += 180;
        if (!isPreviewArrowAnimating) {
            updatePreviewArrow();
        }
    }

    function renderPreviewFiles() {
    const fileList = document.getElementById('fileList');
    fileList.innerHTML = Object.entries(generatedFiles).map(([path, file]) => {
        const explanation = getFileExplanation(path, file);
        return `
            <div class="file-item" onclick="showFilePreview('${path}')">
    <div class="file-category">${file.category}</div>
    <div class="file-name">${file.name}</div>
    <div class="file-explanation">${getFileExplanation(path, file)}</div>
</div>

        `;
    }).join('');
}

function getFileExplanation(path, file) {
    const filename = file.name.toLowerCase();

    const allMaterials = [
        ...VANILLA_MATERIALS.map(m => m[1]),
        ...(customMaterials || []),
        ...(additionalMods.flatMap(mod => mod.customMaterials || []))
    ];

    if (filename === 'blocks.json') {
        return `Registers trim material textures for items (${allMaterials.join(', ')})`;
    }
    if (filename === 'armor_trims.json') {
        return `Registers trim material textures for armor entities (${allMaterials.join(', ')})`;
    }

    const parts = filename.replace('.json', '').split('_');

    if (filename.includes('_trim.json')) {
        const armorType = parts[0];
        const slotType = parts.slice(1, -2).join('_');
        const material = parts[parts.length - 2];

        if (file.category.includes('VanillaCustomSlots')) {
            return `Custom slot: Defines how ${material} trim appears on vanilla ${armorType} ${slotType}`;
        }

        if (file.category.includes('VanillaTrims')) {
            return `Defines how vanilla ${material} trim appears on custom ${armorType} ${slotType}`;
        }

        return `Defines how ${material} trim appears on ${armorType} ${slotType}`;
    }

    if (file.category === 'VanillaItems' || file.category.includes('-ItemModels')) {
        const armorType = parts[0];
        const slotType = parts.slice(1).join('_');
        return `Adds trim material support (${allMaterials.join(', ')}) to ${armorType} ${slotType}`;
    }

    return `Generated file related to trim materials (${allMaterials.join(', ')})`;
}


    function filterPreviewFiles() {
        const searchTerm = document.getElementById('previewSearch').value.toLowerCase();
        const fileItems = document.querySelectorAll('.file-item');

        fileItems.forEach(item => {
            const category = item.querySelector('.file-category').textContent.toLowerCase();
            const name = item.querySelector('.file-name').textContent.toLowerCase();

            if (category.includes(searchTerm) || name.includes(searchTerm)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function showFilePreview(path) {
    const file = generatedFiles[path];
    if (!file) return;

    currentModalFile = path;

    document.getElementById('modalTitle').textContent = file.name;
    document.getElementById('modalContent').textContent = file.content;

    document.getElementById('modalOverlay').classList.add('show');
}


    function closeModal(event) {
        if (event && event.target !== event.currentTarget) return;
        document.getElementById('modalOverlay').classList.remove('show');
    }

    function copyToClipboard() {
        const content = document.getElementById('modalContent').textContent;
        navigator.clipboard.writeText(content).then(() => {
            showToast('Copied to clipboard!', 'success');
        }).catch(err => {
            showToast('Failed to copy', 'error');
            console.error(err);
        });
    }

function updateSummaryStats() {
    const totalFiles = Object.keys(generatedFiles).length;
    const folders = new Set(Object.values(generatedFiles).map(f => f.category));
    const folderCount = folders.size;

    const vanillaArmors = getSelectedArmorTypes();
    const modArmors = Array.from(
        document.querySelectorAll('#modArmorTypesSection input[type="checkbox"]:checked')
    ).map(cb => cb.value);
    const totalArmorTypes = vanillaArmors.length + modArmors.length;

    document.getElementById('summaryStats').innerHTML = `
        <div class="stat-item">
            <span class="stat-number">${totalFiles}</span>
            <span class="stat-label">Total Files</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">${folderCount}</span>
            <span class="stat-label">Folders</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">${totalArmorTypes}</span>
            <span class="stat-label">Armor Types</span>
        </div>
    `;
}

    function attachButtonAnimations() {
        document.querySelectorAll('.minecraft-button, .help-button').forEach(button => {
            button.removeEventListener('mousedown', handleButtonPress);
            button.removeEventListener('mouseup', handleButtonRelease);
            button.removeEventListener('mouseleave', handleButtonRelease);

            button.addEventListener('mousedown', handleButtonPress);
            button.addEventListener('mouseup', handleButtonRelease);
            button.addEventListener('mouseleave', handleButtonRelease);
        });
    }

    function handleButtonPress() {
        this.classList.add('pressed');
    }

    function handleButtonRelease() {
        this.classList.remove('pressed');
    }

    document.addEventListener('DOMContentLoaded', function() {
        renderAdditionalMods();
        updateMainModArmorTypes();
        attachButtonAnimations();
    });

    document.getElementById('modId').addEventListener('input', function() {
    this.classList.remove('invalid');
    document.getElementById('modIdWarning').classList.remove('show');
});

    document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeModal();
    }

    if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
        e.preventDefault();
        undo();
    }

    if ((e.ctrlKey || e.metaKey) && e.key === 'z' && e.shiftKey) {
        e.preventDefault();
        redo();
    }

    if ((e.ctrlKey || e.metaKey) && e.key === 'y') {
        e.preventDefault();
        redo();
    }
});
</script>
<div class="progress-overlay" id="progressOverlay">
    <div class="progress-box">
        <div class="progress-title">Generating Models...</div>
        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progressBarFill"></div>
        </div>
        <div class="progress-text" id="progressText">Preparing...</div>
        <div class="progress-percentage" id="progressPercentage">0%</div>
    </div>
</div>
</body>
</html>